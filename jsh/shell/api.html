<!--
LICENSE
The contents of this file are subject to the Mozilla Public License Version 1.1 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the License at http://www.mozilla.org/MPL/

Software distributed under the License is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either
express or implied. See the License for the specific language governing rights and limitations under the License.

The Original Code is the jsh JavaScript/Java shell.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2010 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>jsh.shell</title>
</head>
<body>
	<div>
		<h1>Context</h1>
		<ul>
			<li class="object">
				<div class="name">api</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="value">
						<div class="name">java</div>
						<span>The rhino/host module.</span>
					</li>
					<li class="value">
						<div class="name">shell</div>
						<span>The rhino/shell module.</span>
					</li>
					<li class="value">
						<div class="name">file</div>
						<span>The rhino/file module.</span>
					</li>
				</ul>
			</li>
			<li class="function">
				<div class="name">getSystemProperty</div>
				<span>__DESCRIPTION__</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">string</span>
							<span>The name of a system property.</span>
						</li>
					</ol>
				</div>
				<div class="returns">
					<div class="label">Returns</div>
					<span class="type">string</span>
					<span>The value of that system property, or <code>null</code>.</span>
				</div>
			</li>
			<li class="value">
				<div class="name">exit</div>
				<span>An implementation of <a href="#$exports.exit"><code>$exports.exit</code></a>.</span>
			</li>
		</ul>
		<script type="application/x.jsapi#context">
			new function() {
				var host = $jsapi.module("../../rhino/host/");
				this.api = {
					java: host,
					shell: $jsapi.module("../../rhino/shell/", {
						api: {
							java: host
						}
					}),
					file: $jsapi.module("../../rhino/file/", new function() {
						this.api = {
							io: jsh.io,
							js: jsh.js,
							java: jsh.java
						};
						this.$pwd = String(jsh.shell.properties.user.dir);
						this.addFinalizer = jsh.loader.addFinalizer;
						//	TODO	below copy-pasted from rhino/file/api.html
						//	TODO	switch to use appropriate jsh properties, rather than accessing Java system properties directly
						var System = Packages.java.lang.System;
						if (System.getProperty("cygwin.root")) {
							this.cygwin = {
								root: String( System.getProperty("cygwin.root") )
							};
							if (System.getProperty("cygwin.paths")) {
								//	Using the paths helper currently does not seem to work in the embedded situation when running inside
								//	the SDK server
								//	TODO	check this
								this.cygwin.paths = String( System.getProperty("cygwin.paths") );
							}
						}
					})
				};

				this.getSystemProperty = function(name) {
					return String(Packages.java.lang.System.getProperty(name));
				}

				this.stdio = new function() {
					this["in"] = jsh.shell.stdin;
					this["out"] = jsh.shell.stdout;
					this["err"] = jsh.shell.stderr;
				}

				this.exit = function() {
				}
			}
		</script>
	</div>
	<div>
		<h1>Exports</h1>
		<div class="type">
			<a class="type" name="types.consolei">console input</a>
			<span class="type">supports <a href="../../rhino/io/api.html#types.binput">byte input stream</a></span>
			<span class="type">supports <a href="../../rhino/io/api.html#types.cinput">character input stream</a></span>
		</div>
		<div class="type">
			<a class="type" name="types.consoleo">console output</a>
			<span class="type">supports <a href="../../rhino/io/api.html#types.boutput">byte output stream</a></span>
			<span class="type">supports <a href="../../rhino/io/api.html#types.coutput">character output stream</a></span>
		</div>
		<ul>
			<li class="function">
				<div class="name"><a name="$exports.exit">exit</a></div>
				<span>Exits from this process.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">number</span>
							<span>The exit code to return to the parent process.</span>
						</li>
					</ol>
				</div>
			</li>
			<li class="value" jsapi:reference="doc['rhino/shell/']..*.(@jsapi::id == 'environment')">
				<div class="name"><a name="$exports.environment">environment</a></div>
				<span>The rhino/shell environment.</span>
			</li>
			<li class="value" jsapi:reference="doc['rhino/shell/']..*.(@jsapi::id == 'properties')">
				<div class="name"><a name="$exports.properties">properties</a></div>
				<span>The rhino/shell properties.</span>
			</li>
			<li class="value">
				<div class="name">stdin</div>
				<span class="type"><a href="#types.consolei">console input</a></span>
				<span>The standard input stream for this shell.</span>
			</li>
			<li class="value">
				<div class="name">stdout</div>
				<span class="type"><a href="#types.consoleo">console output</a></span>
				<span>The standard output stream for this shell.</span>
				<script type="application/x.jsapi#tests">
					test(typeof(module.stdout.write) == "function");
					test(typeof(module.stdout.close) == "function");
				</script>
			</li>
			<li class="value">
				<div class="name">stderr</div>
				<span class="type"><a href="#types.consoleo">console output</a></span>
				<span>The standard error stream for this shell.</span>
				<script type="application/x.jsapi#tests">
					test(typeof(module.stderr.write) == "function");
					test(typeof(module.stderr.close) == "function");
				</script>
			</li>
			<li class="function">
				<div class="name">echo</div>
				<span>Writes a message to the console, or to another specified destination.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">string</span>
							<span>A message to echo.</span>
						</li>
						<li class="object">
							<span>
								(optional) Specifies a destination. The <code>console</code> function, if present, specifies a
								handler for messages. Otherwise, the <code>stream</code> property, if present, specifies a stream to
								which to write messages. If neither is defined, or this argument is omitted entirely, the message
								is written to the <code>jsh.file.Streams.stdout</code> stream.
							</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="function">
									<div class="name">console</div>
									<span>(optional) A <code>function</code> that is able to process messages.</span>
									<div class="arguments">
										<div class="label">Arguments</div>
										<ol>
											<li class="value">
												<span class="type">string</span>
												<span>A message.</span>
											</li>
										</ol>
									</div>
								</li>
								<li class="value">
									<div class="name">stream</div>
									<span class="type">jsh.io character output stream</span>
									<span>(optional) A destination stream for messages.</span>
								</li>

							</ul>
						</li>
					</ol>
				</div>
			</li>
			<li class="function">
				<div class="name">shell</div>
				<span>Executes a subprocess.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">jsh.file.Pathname</span>
							<span>The pathname of the executable to run.</span>
						</li>
						<li class="value">
							<span class="type">Array</span>
							<span>An array containing strings and/or jsh.file.Pathname objects.</span>
						</li>
						<li class="object">
							<span></span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">filesystem</div>
									<span class="type">jsh.file filesystem</span>
									<span>
										(optional) If present, all arguments of type <code>jsh.file.Pathname</code> are converted
										into pathnames in this filesystem before the subprocess is launched.
									</span>
								</li>
								<li class="value">
									<div class="name">environment</div>
									<span class="type">object</span>
									<span>
										(optional) The environment to pass to the subprocess; if not provided, the parent's will be
										used.
									</span>
								</li>
								<li class="value">
									<div class="name">stdin</div>
									<span class="type">JavaClass java.io.InputStream</span>
									or <span class="type">jsh.file byte input stream</span>
									<span>
										(optional) The stream to use as the standard input stream of the subprocess. If
										<code>null</code>, an empty stream will be used.
										<!--	TODO	add ability to use Streams.stdin if undefined here, which requires defining
														Streams.stdin	-->
									</span>
								</li>
								<li class="value">
									<div class="name">stdout</div>
									<span class="type">JavaClass java.io.OutputStream</span>
									or <span class="type">jsh.file byte output stream</span>
									<span>
										(optional) The stream to use as the standard output stream of the subprocess. If not
										present, the standard output stream of this process will be used. If <code>null</code>,
										bytes written will be discarded.
									</span>
								</li>
								<li class="value">
									<div class="name">stderr</div>
									<span class="type">JavaClass java.io.OutputStream</span>
									or <span class="type">jsh.file byte output stream</span>
									<span>
										(optional) The stream to use as the standard error stream of the subprocess. If not
										present, the standard error stream of this process will be used. If <code>null</code>,
										bytes written will be discarded.
									</span>
								</li>
								<li class="value">
									<div class="name">workingDirectory</div>
									<span class="type">jsh.file directory</span>
									<span>
										(optional) The working directory to use for the subprocess. If not specified, the
										working directory of the parent process will be used.
									</span>
								</li>
								<li class="function" jsapi:reference="doc['rhino/shell/']..*.(@jsapi::id == 'run.onExit')">
									<div class="name">onExit</div>
									<span>rhino/shell onExit</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
			</li>
			<li class="function">
				<div class="name">jsh</div>
				<span>Runs a jsh script.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">rhino/file Pathname</span>
							<span>The pathname of the script to run.</span>
						</li>
						<!--	TODO	update the below using jsapi:reference	-->
						<li class="value">
							<span class="type">Array</span>
							<span>An argument with the same semantics as the second argument to <code>shell</code>.</span>
						</li>
						<li class="value">
							<span class="type">object</span>
							<span>
								An argument with the same semantics as the third argument to <code>shell</code>, except that
								it includes the following properties in addition:
							</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">classpath</div>
									<span class="type">string</span>
									<span>The classpath to use when running the jsh launcher.</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
			</li>
			<li class="object">
				<div class="name">java</div>
				<span>A description of the Java environment for this shell.</span>
				<div class="label">has properties:</div>
				<ul>
					<li class="value">
						<div class="name">home</div>
						<span class="type">jsh.file directory</span>
						<span>The home directory of the Java installation used to run this shell.</span>
					</li>
				</ul>
				<script type="application/x.jsapi#tests">
					test(Boolean(module.java.home));
				</script>
			</li>
			<li class="value">
				<div class="name">TMPDIR</div>
				<span class="type">jsh.file directory</span>
				<span>A temporary directory that may be used by this shell.</span>
			</li>
			<li class="value">
				<div class="name">HOME</div>
				<span class="type">jsh.file directory</span>
				<span>The home directory of the user executing this shell.</span>
			</li>
			<li class="value">
				<div class="name">PWD</div>
				<span class="type">jsh.file directory</span>
				<!--	TODO	can this be changed while the shell is running?	-->
				<span>The current working directory.</span>
			</li>
		</ul>
	</div>
<!--
$doc.members.echo = new $Doc.Function({
	summary: "Prints information to a console.",
	asFunction: {
		description: <>Prints an argument to a console.  Normally, the console is provided by the execution environment, but
			this behavior can be controlled with the mode argument.
		</>,
		arguments: {
			list: [
				{
					comment: <>(optional) An argument which will be converted to a string using the following algorithm:
						<ul>
							<li>If the argument is a string, it will not be altered</li>
							<li>If the argument is an object, its <code>toString()</code> method will be invoked</li>
							<li>Otherwise, the result of the conversion is not defined.</li>
						</ul>
						If not present, this method simply prints a blank line.
					</>
				},
				{
					comment: <>(optional) An object representing the mode of operation for this function.</>,
					type: new $Doc.Type({
						members: {
							stream: {
								type: $doc.types.coutput,
								summary: <>A character stream to which to direct console messages.  If
									<code>console</code> is not present, messages will be directed to this stream.  If neither
									is present, messages will be sent to a default location.
								</>,
							},
							console: {
								type: "function",
								summary: <>A function which takes a single string argument and emits it.</>,
							}
						}
					})
				}
			]
		}
	}
});

$doc.members.shell = new $Doc.Function({
	summary: "Executes a subprocess.",
	asFunction: {
		description: <>Launches a subprocess of this process to execute a specified command with specified arguments.</>,
		arguments: {
			description: <>By default, the standard input, standard output, standard error, and working directory will be inherited
				from this process, unless overridden by the mode argument.
			</>,
			list: [
				{ type: "string", comment: "The command to run" },
				{ type: "Array of string", comment: "The arguments to pass to the subprocess" },
				{
					comment: "An object representing the mode of execution for this function.",
					type: new $Doc.Type({
						members: {
							stdin: {
								name: "stdin",
								type: $doc.types.binput,
								summary: <>A stream that will be used as the standard input stream for the subprocess</>,
							},
							stdout: {
								name: "stdout",
								type: $doc.types.boutput,
								summary: <>A stream to which the standard output stream of the subprocess will be written.  If
									<code>null</code>, the output will be discarded.  The default is
									<code>jsh.file.Streams.stdout</code>.
								</>,
							},
							stderr: {
								name: "stderr",
								type: $doc.types.boutput,
								summary: <>A stream to which the standard error stream of the subprocess will be written.  If
									<code>null</code>, the output will be discarded.  The default is
									<code>jsh.file.Streams.stderr</code>.</>,
							},
							workingDirectory: {
								name: "workingDirectory",
								type: $doc.types.Directory,
								summary: <>A directory that will be used as the current working directory for the subprocess</>,
							},
							environment: {
								name: "environment",
								type: "object",
								summary: <>An object containing the environment to send to the subprocess.  If <code>null</code> or
									<code>undefined</code>, the subprocess will inherit this process's environment.
								</>
							},
							onExit: {
								name: "onExit",
								type: new $Doc.Type({
									summary: "Information about a subprocess",
									members: {
										command: {
											name: "command",
											type: "string",
											summary: "The command invoked.",
										},
										arguments: {
											name: "arguments",
											type: "Array of string",
											summary: "The arguments sent to the command.",
										},
										status: {
											name: "status",
											type: "number",
											summary: "The exit status of the command",
										}
									}
								}),
								summary: <>A callback function that will be invoked when the subprocess exits.  The function will
									be invoked with an argument containing information about the subprocess.
								</>,
							},
							filesystem: {
								type: $doc.types.Filesystem,
								summary: <>If provided, all file-related arguments to the program will be converted to the given
									filesystem.
								</>,
							}
						}
					})
				}
			]
		}
	}
});

var $run;

$unit.environment = function() {
	$run = function(tokens,mode) {
		Packages.java.lang.System.err.println("SIMULATED SHELL: command=" + tokens.join(",") + " mode=" +
			mode.toSource()
		);
	}
}

$unit.execute = function(scope) {
/*
	scope.scenario( new function() {
		this.name = "run()";
		this.execute = function(scope) {
			scope.scenario( new function() {
				this.name = "working directory";

				this.execute = function(scope) {
					scope.test(
						run.$createWork(new java.io.File(Packages.java.lang.System.getProperty("user.dir")))["class"].name
						== "java.io.File"
					)
				}
			} );
		}
	} );
*/
}
-->
</body>
</html>