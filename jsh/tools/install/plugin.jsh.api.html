<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
	<head>
		<title>jsh.tools.install, jsh.shell.tools.*</title>
		<link href="../../../loader/api/api.css" rel="stylesheet" type="text/css" />
		<script src="../../../loader/api/api.js"></script>
	</head>
	<body>
		<div>Plugin which adds APIs to multiple namespaces:
			<ul>
				<li><code>jsh.tools.install</code>: APIs for installing software generally.</li>
				<li>
					<code>jsh.shell.tools.*</code>: APIs for a specific set of externally-provided tools (Rhino, Tomcat,
					<code>ncdbg</code>), including installation APIs.
				</li>
			</ul>
		</div>
		<div>
			<h1><code><a id="exports.jsh.tools.install">jsh.tools.install</a></code></h1>
			<div><code>jsh</code> plugin for installing external software. See TypeScript namespace <code>slime.jrunscript.tools.install</code>.</div>
		</div>
		<div>
			<script tyoe="application/x.jsapi#initialize">
				jsh.loader.plugins($jsapi.loader);
			</script>
			<h1><code><a id="exports.jsh.shell.tools">jsh.shell.tools</a></code></h1>
			<ul>
				<li class="object">
					<div class="name">rhino</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">install</div>
							<span>Installs Rhino as a JavaScript engine for the currently executing shell.</span>
							<!--	Uses jrunscript API	-->
							<!--	TODO	document: does it use local copy if present?	-->
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="object">
										<span>
											(optional; defaults to empty object)
										</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<!--	TODO	no tests for this property	-->
												<div class="name">local</div>
												<span class="type"><a href="../../../rhino/file/api.html#types.file">file</a></span>
												<span>The Rhino JAR file.</span>
											</li>
											<li class="value">
												<div class="name">replace</div>
												<span class="type">boolean</span>
												<span>Whether to proceed if Rhino is already part of the shell.</span>
											</li>
										</ul>
									</li>
									<li class="value">
										<span class="type">on</span>
										<span>An event listener.</span>
									</li>
								</ol>
							</div>
							<script type="application/x.jsapi#tests">
								var Captor = function() {
									var events = [];

									this.console = function(e) {
										events.push(e);
									}

									this.installed = function(e) {
										events.push(e);
									}

									this.captured = events;

									this.captured.type = function(type) {
										return events.filter(function(e) { return e.type == type; });
									}
								}

								var lib = jsh.shell.TMPDIR.createTemporary({ directory: true });

								var mock = { lib: lib };

								var readFile = function() {
									return this.read(String);
								};

								(function alreadyInstalled() {
									lib.getRelativePath("js.jar").write("already", { append: false });
									var captor = new Captor();
									jsh.shell.tools.rhino.install({ mock: mock }, captor);
									verify(captor).captured[0].type.is("console");
									verify(captor).captured[0].detail.is("Rhino already installed at " + lib.getFile("js.jar"));
									verify(lib).getFile("js.jar").evaluate(readFile).is("already");
									verify(captor.captured.type("installed")).length.is(0);
									lib.getFile("js.jar").remove();
								})();

								(function replace() {
									lib.getRelativePath("js.jar").write("original", { append: false });
									lib.getRelativePath("download").write("downloaded", { append: false });
									mock.rhino = lib.getFile("download");
									var captor = new Captor();
									jsh.shell.tools.rhino.install({ mock: mock, replace: true }, captor);
									verify(captor).captured[0].type.is("console");
									verify(captor).captured[0].detail.is("Installing Rhino ...");
									verify(lib).getFile("js.jar").evaluate(readFile).is("downloaded");
									verify(captor.captured.type("installed")).length.is(1);
									lib.getFile("js.jar").remove();
								})();

								(function install() {
									lib.getRelativePath("download").write("downloaded", { append: false });
									mock.rhino = lib.getFile("download");
									var captor = new Captor();
									jsh.shell.tools.rhino.install({ mock: mock }, captor);
									verify(captor).captured[0].type.is("console");
									verify(captor).captured[0].detail.is("Installing Rhino ...");
									verify(lib).getFile("js.jar").evaluate(readFile).is("downloaded");
									verify(captor.captured.type("installed")).length.is(1);
									lib.getFile("js.jar").remove();
								})();
							</script>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">graal</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
					</ul>
				</li>
				<li class="object">
					<div class="name">tomcat</div>
					<span>__DESCRIPTION__</span>
					<div class="type">
						<a class="type" name="types.tomcat.installation">installation</a>
						<span>A Tomcat installation.</span>
						<div class="label">has properties:</div>
						<ul>
							<li class="value">
								<div class="name">version</div>
								<div class="label">has properties:</div>
								<ul>
									<li class="function">
										<div class="name">toString</div>
										<span></span>
										<div class="returns">
											<div class="label">Returns</div>
											<span class="type">string</span>
											<span>The version string for this Tomcat; e.g., <code>"7.0.70"</code>.</span>
										</div>
									</li>
								</ul>
								<span>An object representing the installed version of Tomcat.</span>
							</li>
						</ul>
					</div>

					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">installed</div>
							<span>Returns information about a currently installed Tomcat.</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="object">
										<span>(optional; if omitted, an empty object is used)</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">home</div>
												<span class="type">directory</span>
												<span>
													(optional; if omitted, returns information about the version installed with
													<code>jsh</code>)
												</span>
											</li>
										</ul>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type"><a href="#types.tomcat.installation">installation</a></span>
							</div>
							<script type="application/x.jsapi#tests">
								var toString = function() {
									return this.toString();
								};

								var installed = jsh.shell.tools.tomcat.installed({ mock: { notes: $jsapi.loader.get("test/data/tomcat-release-notes-7.0.70.txt") } });
								verify(installed).version.evaluate(toString).is("7.0.70");
							</script>
						</li>
						<li class="function">
							<div class="name">install</div>
							<span>Installs Tomcat to a given directory (or to the shell).</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="object">
										<span></span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">to</div>
												<span class="type">Pathname</span>
												<span>
													(optional; defaults to installing into <code>jsh</code>)
												</span>
											</li>
											<li class="value">
												<div class="name">replace</div>
												<span class="type">boolean</span>
												<span>
													Whether to replace an installation found at the given <code>to</code>.
												</span>
											</li>
											<li class="value">
												<div class="name">version</div>
												<span class="type">string</span>
												<span>
													(optional; defaults to latest version of Tomcat 7 if no <code>local</code>,
													otherwise attempts to parse filename of <code>local</code>)
												</span>
											</li>
											<li class="value">
												<div class="name">local</div>
												<span class="type"><a href="../../../rhino/file/api.html#types.file">file</a></span>
												<span>A local Tomcat distribution to install.</span>
											</li>
										</ul>
									</li>
								</ol>
							</div>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">ncdbg</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
					</ul>
				</li>
				<li class="object">
					<div class="name">kotlin</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
					</ul>
				</li>
				<li class="object">
					<div class="name">jsoup</div>
					<span>An optional HTML parser that can be added to <code>jsh</code> shells.</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">install</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="object">
										<div class="name">__NAME__</div>
										<span>__DESCRIPTION__</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">upgrade</div>
												<span class="type">__TYPE__</span>
												<span>__DESCRIPTION__</span>
											</li>
										</ul>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
						</li>
						<li class="value">
							<div class="name">installed</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">javamail</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
					</ul>
				</li>
				<li class="object">
					<div class="name">postgresql</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="object">
							<div class="name">jdbc</div>
							<span>__DESCRIPTION__</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="function">
									<div class="name">install</div>
									<span>__DESCRIPTION__</span>
									<div class="arguments">
										<div class="label">Arguments</div>
										<ol>
										</ol>
									</div>
									<div class="returns">
										<div class="label">Returns</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</div>
								</li>
								<li class="value">
									<div class="name">installed</div>
									<span class="type">__TYPE__</span>
									<span>__DESCRIPTION__</span>
								</li>
							</ul>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">jsyaml</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">install</div>
							<span>
								Installs the <code>master</code> version of <code>js-yaml</code> into the shell so that it can be
								loaded by <code>load()</code>. Any version present is overwritten.
							</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type"><a href="https://github.com/nodeca/js-yaml/blob/master/README.md">js-yaml</a> API</span>
								<span>__DESCRIPTION__</span>
							</div>
						</li>
						<li class="function">
							<div class="name">load</div>
							<span>Loads the <code>js-yaml</code> API and returns it, retrieving it online if necessary.</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type"><a href="https://github.com/nodeca/js-yaml/blob/master/README.md">js-yaml</a> API</span>
								<span>__DESCRIPTION__</span>
							</div>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">node</div>
					<span>
						(conditional; see below) APIs pertaining to the global Node.js installation for <code>jsh</code>.
					</span>
					<div>
						If Node.js is installed in this installation of <code>jsh</code>, this object will be a Node.js
						<code>Installation</code>, augmented with the following property:
						<div class="label">has properties:</div>
						<ul>
							<li class="function">
								<div class="name">update</div>
								<span>
									Updates the <code>jsh</code> Node.js (removing all globally-installed modules), replacing
									the <code>jsh.shell.tools.node</code> object with the new installation.
									<!--	TODO	but now lacks update() method; should we fix that somehow?	-->
								</span>
								<div class="returns">
									<div class="label">Returns</div>
									<span class="type">__TYPE__</span>
									<span>__DESCRIPTION__</span>
								</div>
							</li>
						</ul>
					</div>
					<div>
						If Node.js is not installed in this <code>jsh</code> installation, but can be installed, it will be an
						object with the following properties:
					</div>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">install</div>
							<span>Creattes a global Node.js installation for <code>jsh</code>.</span>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
						</li>
					</ul>
				</li>
			</ul>
		</div>
		<div>
			<h1>Other tools</h1>
			<div>
				<h2>POI</h2>
				<div>
					POI can be installed using <code>jsh/tools/install/poi.jsh.js</code>. This will add an Excel-based grid
					implementation to <code>jrunscript/io</code>.
					<script type="application/x.jsapi#tests">
						var poi = jsh.shell.jsh.lib.getSubdirectory("poi");
						if (poi) {
							verify(jsh).io.grid.excel.is.type("object");
						} else {
							verify(jsh).io.grid.evaluate.property("excel").is(void(0));
						}
					</script>
				</div>
			</div>
		</div>
	</body>
</html>
