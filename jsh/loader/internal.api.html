<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.


The Original Code is the jsh JavaScript/Java shell.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2016 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
	<head>
		<title>jsh Loader implementation</title>
		<link href="../../loader/api/api.css" rel="stylesheet" type="text/css" />
		<script src="../../loader/api/api.js"></script>
		<script>
			//	TODO	CORS
			document.domain = document.domain;
		</script>
	</head>
	<body>
		<div>
			The <code>jsh</code> <dfn>loader</dfn> is a subsystem that can run in its own VM or within an isolated classloader, and
			which implements the execution of a script. It has two implementations: a Rhino implementation
			(<code>inonit.script.jsh.Rhino</code>) and a Nashorn implementation (<code>inonit.script.jsh.Nashorn</code>); the
			entry point is chosen and executed by the launcher subsystem.
		</div>
		<div>
			<h1>Execution</h1>
			<div>
				Generally speaking, the execution of the shell is governed by the <code>inonit.script.jsh.Shell.Execution</code>
				class. Both the Rhino and Nashorn engines provide implementations of this class, and use them (separately) to help
				them implement their methods related to executing shells.
			</div>
			<div>
				This method generally follows the following steps:
				<ul>
					<li>
						Provide the engine's classpath implementation to the <code>inonit.script.jsh.Shell</code>.
					</li>
					<li>
						Set the <code>$jsh</code> property of the global object to the <code>inonit.script.jsh.Shell</code> instance.
					</li>
					<li>
						Set an engine-specific host property, and run an engine-specific script with that host property in scope:
						<ul>
							<li>
								For Rhino, sets a <code>$rhino</code> property which is of type <code>inonit.script.jsh.Rhino.Interface</code>.
							</li>
							<li>
								For Nashorn, sets a <code>$nashorn</code> property which is of type <code>inonit.script.jsh.Nashorn.Host</code>.
							</li>
						</ul>
					</li>
					<li>
						Run an engine-specific shell embedding script; for Rhino, runs <code>jsh/loader/rhino.js</code>, and for
						Nashorn, runs <code>jsh/loader/nashorn.js</code>.
						<ul>
							<li>
								Each of these scripts, in turn, runs an engine-specific engine embedding script to set up the engine. Rhino runs
								<code>loader/rhino/rhino.js</code>, and Nashorn runs <code>loader/rhino/nashorn.js</code>. These
								scripts create engine-specific implementations of <code>$javahost</code> and <code>$bridge</code>
								objects.
							</li>
							<li>
								Then the generic container interface script <code>loader/rhino/literal.js</code> is evaluated,
								using the <code>$javahost</code> and <code>$bridge</code> objects in scope.
								<ul>
									<li>
										It first invokes <code>loader/expression.js</code>, providing appropriate implementations of
										<code>$slime</code> and <code>$engine</code>,
										to create the <a href="../../loader/api.html">SLIME runtime</a>.
									</li>
									<li>
										It then post-processes the SLIME runtime to provide additional
										<a href="../../loader/rhino/api.html">Java-specific</a> interfaces.
									</li>
								</ul>
							</li>
							<li>
								The SLIME runtime is possibly post-processed by
								the engine embedding script before being returned to the shell embedding script.
							</li>
							<li>
								The shell embedding script may post-process the result as well, before sending that object
								to the <code>inonit.script.jsh.Shell</code>'s <code>setRuntime()</code> method.
							</li>
						</ul>
					</li>
					<li>
						Run the <code>jsh.js</code> script. This script:
						<ul>
							<li>Receives the <code>inonit.script.jsh.Shell</code> object in scope as <code>$jsh</code>.</li>
							<li>
								Retrieves the SLIME runtime created by the shell embedding script, and adds more APIs to it using
								various properties of the <code>inonit.script.jsh.Shell</code> (<code>$jsh</code>) object.
							</li>
							<li>
								This runtime is provided to the various plugins that make up the shell; see the documentation on
								<a href="plugin.api.html">plugins</a>.
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
		<div>
			<h1>Rhino</h1>
		</div>
		<div>
			<h1>Context</h1>
			<ul>
			</ul>
		</div>
		<div>
			<h1>Exports</h1>
			<ul>
			</ul>
		</div>
	</body>
</html>