<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>jsh profiler documentation</title>
	<link rel="stylesheet" type="text/css" href="../../loader/api/api.css" />
	<script src="../../loader/api/api.js"></script>
</head>
<body>
	<div>
		<h1>Usage</h1>
		<div>
			<h2>jsh/tools/profile.jsh.js</h2>
		</div>
		<div>
			<h2>jsh/tools/install/profiler.jsh.js</h2>
		</div>
		<div>
			<h2>rhino/tools/profiler/build.jsh.js</h2>
		</div>
	</div>
	<div>Profiler parameters are specified as name-value pairs.</div>
	<div>
		<h1>Parameters</h1>
		<div jsapi:id="parameters">
			<ul>
				<li>
					<code>listener</code>: specifies the location of a JavaScript file that will be executed when the program
					terminates. The script will have the following variables in scope, in addition to <code>jsh</code>:
					<div class="label">has properties:</div>
					<ul>
						<li class="value">
							<div class="name">$loader</div>
							<span class="type">Rhino <a href="../../../loader/jrunscript/api.html#types.Loader">Loader</a></span>
							<span>A loader from which the profiler listener can load associated code via its relative path.</span>
						</li>
						<li class="value">
							<div class="type">
								<a class="type" name="types.code">Java method</a>
								<span>An object describing a Java method.</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">className</div>
										<span class="type">string</span>
										<span>The name of the class containing the method.</span>
									</li>
									<li class="value">
										<div class="name">methodName</div>
										<span class="type">string</span>
										<span>The name of the method.</span>
									</li>
									<li class="value">
										<div class="name">signature</div>
										<span class="type">string</span>
										<span>The signature of the method; currently the format is undefined.</span>
									</li>
								</ul>
							</div>
							<div class="type">
								<a class="type" name="types.code">script function</a>
								<span>An object describing a JavaScript function.</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">sourceName</div>
										<span class="type">string</span>
										<span>A string describing the source file from which the function was loaded.</span>
									</li>
									<li class="value">
										<div class="name">lineNumbers</div>
										<span class="type">Array of number</span>
										<span>(experimental) The line numbers of the source included in the function.</span>
									</li>
									<li class="value">
										<div class="name">functionName</div>
										<span class="type">string</span>
										<span>
											(if defined by the source)
											The name of the JavaScript function.
										</span>
									</li>
								</ul>
							</div>
							<div class="type">
								<a class="type" name="types.node">node</a>
								<span>
									An object representing a call stack within an application and data surrounding its execution.
								</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">code</div>
										<span class="type"><a href="#types.code.java">Java method</a></span>
										-OR-
										<span class="type"><a href="#types.code.script">script function</a></span>
										<span>The unit of code on top of the stack at this point in the call tree.</span>
									</li>
									<li class="object">
										<div class="name">statistics</div>
										<span>The numbers collected for this node during execution.</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">count</div>
												<span class="type">number</span>
												<span>The number of times this call stack was reached.</span>
											</li>
											<li class="value">
												<div class="name">elapsed</div>
												<span class="type">number</span>
												<span>The total elapsed time spent within this call stack.</span>
											</li>
										</ul>
									</li>
									<li class="value">
										<div class="name">children</div>
										<span class="type">Array of <a href="#types.node">node</a></span>
										<span>
											The set of nodes representing invocations from this point on the call stack.
										</span>
									</li>
								</ul>
							</div>
							<div class="type">
								<a class="type" name="types.profile">profile</a>
								<span>An execution profile for a particular thread.</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="object">
										<div class="name">thread</div>
										<span>An execution thread.</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">name</div>
												<span class="type">string</span>
												<span>The name of this thread.</span>
											</li>
										</ul>
									</li>
									<li class="object">
										<div class="name">timing</div>
										<span>An object representing timing data about the given thread.</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">root</div>
												<span class="type"><a href="#types.node">node</a></span>
												<span>A node representing an empty call stack within the given thread.</span>
											</li>
										</ul>
									</li>
								</ul>
							</div>
							<div class="name">profiles</div>
							<span class="type">Array of <a href="#types.profile">profile</a></span>
							<span>
								An array containing a profile for each thread.
							</span>
						</li>
					</ul>
				</li>
				<li>
					<code>output</code>: specifies the path in the filesystem to an HTML page that will allow browsing the data
					collected by the profiler.
				</li>
				<li>
					<!--	TODO	allow filtering of scripts?	-->
					<!--	TODO	allow filtering other than via literal prefix?	-->
					<code>exclude</code>: specifies a prefix describing Java classes to exclude. This path is used literally; if
					a class name starts with the value given, its profiling data will not be collected and will be excluded from
					the output. This value can be specified multiple times to exclude multiple patterns.
				</li>
			</ul>
		</div>
	</div>
</body>
</html>
