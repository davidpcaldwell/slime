<!--
LICENSE
The contents of this file are subject to the Mozilla Public License Version 1.1 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the License at http://www.mozilla.org/MPL/

Software distributed under the License is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either
express or implied. See the License for the specific language governing rights and limitations under the License.

The Original Code is the jsh JavaScript/Java shell.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2010 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>jsh.script</title>
	<style type="text/css">
		#getopts { border-collapse: collapse; margin: 0em 0.5em; }
		#getopts td { border: 1px solid; padding: 0.2em; }
		#getopts th { padding: 0em 0.4em; }
	</style>
</head>
<body>
	<script type="application/x.jsapi#initialize">
	</script>
	<div class="type">
		<a class="type" name="types.Loader">Loader</a>
		<span>An object that can load code from logical paths denoted by strings.</span>
		<div class="label">has properties:</div>
		<ul>
			<li class="function">
				<div class="name">run</div>
				<span>
					Analogous to the jsh.loader method of the same name; see
					<code><a href="../../jsh/loader/api.html#exports.run">jsh.loader.run</a></code> for details.
				</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">string</span>
							<span>A logical path to a code file to run.</span>
						</li>
						<li class="value" jsapi:reference="getApi('../../jsh/loader/').getElement('run/arguments[1]')">
							<div class="name">__NAME__</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
						<li class="value" jsapi:reference="getApi('../../jsh/loader/').getElement('run/arguments[2]')">
							<div class="name">__NAME__</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
					</ol>
				</div>
			</li>
			<li class="function">
				<div class="name">file</div>
				<span>
					Analogous to the jsh.loader method of the same name; see
					<code><a href="../../jsh/loader/api.html#exports.file">jsh.loader.file</a></code> for details.
				</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">string</span>
							<span>A logical path to a code file to run.</span>
						</li>
						<li class="value" jsapi:reference="getApi('../../jsh/loader/api.html').getElement('file/arguments[1]')">
							The second argument to the Rhino loader
							<a href="../../jsh/loader/api.html#exports.file">file</a> method.
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
					</ol>
				</div>
				<div class="returns" jsapi:reference="getApi('../../jsh/loader/').getElement('file/returns')">
					<div class="label">Returns</div>
					<span class="type">__TYPE__</span>
					<span>__DESCRIPTION__</span>
				</div>
			</li>
			<li class="function">
				<div class="name">module</div>
				<span>
					Analogous to the jsh.loader method of the same name; see
					<code><a href="../../jsh/loader/api.html#exports.module">jsh.loader.module</a></code> for details.
				</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type">string</span>
							<span>A logical path to a module to load.</span>
						</li>
						<li class="value" jsapi:reference="getApi('../../jsh/loader/').getElement('module/arguments[1]')">
							<div class="name">__NAME__</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
					</ol>
				</div>
				<div class="returns" jsapi:reference="getApi('../../jsh/loader/').getElement('module/returns')">
					<div class="label">Returns</div>
					<span class="type">__TYPE__</span>
					<span>__DESCRIPTION__</span>
				</div>
			</li>
		</ul>
	</div>
	<div>
		<h1>Context</h1>
		<ul>
			<li class="object">
				<div class="name">api</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="value">
						<div class="name">file</div>
						<span>The rhino/file module.</span>
					</li>
					<li class="function">
						<div class="name">addClasses</div>
						<span>Adds a file to the classpath of this script.</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">jsh.file Pathname</span>
									<span>A file to add to the classpath (either a directory or a .jar file)</span>
								</li>
							</ol>
						</div>
					</li>
				</ul>
			</li>
			<li class="value">
				<div class="name">script</div>
				<span class="type">rhino/file file</span>
				<span>The object representing the main script file this shell is running.</span>
			</li>
			<li class="value">
				<div class="name">packaged</div>
				<span class="type">rhino/file file</span>
				<span>The object representing the package file this shell is running.</span>
			</li>
			<li class="value">
				<div class="name">arguments</div>
				<span class="type">Array of string</span>
				<span>The arguments passed to the script.</span>
			</li>
			<li class="constructor">
				<!--	TODO	modularize; get this description from the export property below	-->
				<div class="name">Loader</div>
				<span>__DESCRIPTION__</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type"><a href="../../rhino/file/api.html#types.directory">rhino/file directory</a></span>
							<span>The base directory for this loader.</span>
						</li>
					</ol>
				</div>
				<div class="instances">
					<div class="label">Instances</div>
					<span class="type"><a href="#types.Loader">Loader</a></span>
					<span>__DESCRIPTION__</span>
				</div>
			</li>
			<li class="value">
				<div class="name">loader</div>
				<span class="type"><a href="#types.Loader">Loader</a></span>
				<span>
					(optional)
					An object that can load code from the currently running package file, if the current script is packaged.
				</span>
			</li>
		</ul>
		<script type="application/x.jsapi#context">
			(function() {
				var host = $jsapi.module("../../rhino/host/", {
					loadClass: function(name) {
						return $host.getLoader().getJavaClass(name)
					}
				});
				var context = {
					api: {
						js: $jsapi.module("../../js/object/"),
						java: host,
						io: $jsapi.module("../../rhino/io/", {
							$java: new Packages.inonit.script.runtime.io.Streams(),
							api: {
								java: host
							}
						})
					},
					$pwd: String(jsh.shell.properties.user.dir)
				};
				var System = Packages.java.lang.System;
				if (System.getProperty("cygwin.root")) {
					context.cygwin = {
						root: String(System.getProperty("cygwin.root"))
					};
					if (System.getProperty("cygwin.paths")) {
						context.cygwin.paths = String(System.getProperty("cygwin.paths"));
					}
				};
				var file = $jsapi.module("../../rhino/file/", context);
				var $filesystem = file.filesystem;
				var FILE = file;
				return new function() {
					this.api = new function() {
						this.file = file;
						this.addClasses = jsh.loader.addClasses;
					};

					this.script = jsh.script.file;
					this.arguments = ["a","bb","C"];

					this.Loader = jsh.script.Loader;
					//	loader

					//	TODO	what are the next two for?
					this.$filesystem = $filesystem;
					this.FILE = file;
				}
			})()
		</script>
	</div>
	<div>
		<h1>Exports</h1>
		<ul>
			<li class="value">
				<div class="name">file</div>
				<span class="type">jsh.file file</span>
				<span>
					The object representing the main file being executed.
					In the case of an ordinary script, this is the script that was launched.
					In the case of a packaged script, it is the package file.
				</span>
			</li>
			<li class="value">
				<div class="name">script</div>
				<span class="type">jsh.file file</span>
				<span>
					(optional)
					The object representing the script being executed. In the case of a packaged script, this value will be absent
					as the script is embedded in the package file itself.
				</span>
			</li>
			<li class="value">
				<div class="name">arguments</div>
				<span class="type">Array of string</span>
				<span>An array containing the arguments passed to the shell.</span>
			</li>
			<li class="constructor">
				<div class="name"><a id="exports.Loader">Loader</a></div>
				<span>A constructor that can be used by scripts to create <a href="#types.Loader">Loader</a>s.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="value">
							<span class="type"><a href="../../rhino/file/api.html#types.directory">rhino/file directory</a></span>
							<span>
								A base directory. Paths within this loader will be resolved as pathnames relative to this
								directory.
							</span>
						</li>
					</ol>
				</div>
				<div class="instances">
					<div class="label">Instances</div>
					<span class="type"><a href="#types.Loader">Loader</a></span>
					<span>An object that loads code from the files and subdirectories of the given directory.</span>
				</div>
			</li>
			<li class="value">
				<div class="name">loader</div>
				<span class="type"><a href="#types.Loader">Loader</a></span>
				<span>
					An object that can be used to load code associated with this script. For packaged scripts, this object loads
					modules and files packaged with the script using the packaging tool. For unpackaged scripts, this object loads
					modules and files relative to the directory from which the script was run (although a script can replace this
					property; see <code><a href="#exports.Loader">Loader</a></code>).
				</span>
			</li>
			<li class="function">
				<div class="name">getopts</div>
				<span>
					Processes an array of strings as arguments, using an object which specifies how arguments are interpreted.
				</span>
				<div>
					An "option" is an argument which is prefixed with a dash (<code>-</code>) character. The argument immediately
					following the option is, depending on the option's type, interpreted as a value for that option.
				</div>
				<div>
					For example, the following code:
					<pre>var parameters = jsh.script.getopts({
	options: {
		s: String,
		n: Number,
		num: 8,
		b: false,
		p: Boolean,
		list: jsh.script.getopts.ARRAY(String)
	}
}, [ "-s", "aString", "-n", 42, "-b", "-list", "a", "-list", "b" ]);</pre>
					produces an object equivalent to:
					<pre>var parameters = { options: { s: "aString", n: 42, num: 8, b: true, p: false, list: ["a", "b"] } };</pre>
				</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="object">
						<div class="name">UNEXPECTED_OPTION_PARSER</div>
						<span>A set of possibilities for handling unrecognized options.</span>
						<div class="label">has properties:</div>
						<ul>
							<li class="value">
								<div class="name">ERROR</div>
								<span>An unexpected options handler that treats any unrecognized option as an error.</span>
							</li>
							<li class="value">
								<div class="name">IGNORE</div>
								<span>An unexpected options handler that discards any unrecognized options.</span>
							</li>
							<li class="value">
								<div class="name">SKIP</div>
								<span>
									An unexpected options handler that preserves any unrecognized options in the
									<code>arguments</code> member of the <code>getopts</code> return value.
								</span>
							</li>
							<li class="value">
								<div class="name">INTERPRET</div>
								<span>
									An unexpected options handler that attempts to handle unrecognized options.  If the argument
									following the unrecognized option name is another option, the argument will be interpreted as a
									<code>boolean</code> argument with value <code>true</code>.  Otherwise, the argument will be
									interpreted as a <code>string</code> argument with its value specified by the next argument.
								</span>
							</li>
						</ul>
					</li>
				</ul>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="object">
							<span>An object describing how the arguments should be processed.</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">options</div>
									<span class="type">object</span>
									<span>
										Each named property of this object is the name of a recognized option. The value of
										a property describes the possible values of the option.
									</span>
									<div>

									</div>
								</li>
								<li class="value">
									<div class="name">unhandled</div>
									<span>
										(optional) One of the properties of the <code>UNEXPECTED_OPTION_PARSER</code>
										object.
									</span>
								</li>
							</ul>
						</li>
						<li class="value">
							<span class="type">Array of string</span>
							<span>
								(optional) A list of arguments to be processed.  If omitted, the values in
								<code>jsh.script.arguments</code> will be processed.
							</span>
						</li>
					</ol>
				</div>
				<div class="returns">
					<div class="label">Returns</div>
					<span>An object containing the result of parsing the argument list.</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="value">
							<div class="name">options</div>
							<span class="type">object</span>
							<span>
								Each property of this object represents an option parsed; the name of the property indicates the
								option's name and its value indicates the option's value.
							</span>
							<div>
								Several option types are possible.
								<table id="getopts">
									<tr>
										<th>Declaration</th>
										<th>Type</th>
										<th>Declaration with default value</th>
										<th>Value if present</th>
										<th>Value if not present and no default</th>
									</tr>
									<tr>
										<td><code>Boolean</code></td>
										<td><code>boolean</code></td>
										<td><code>false</code> (<code>true</code> is illegal, as value would not be negatable)</td>
										<td><code>true</code></td>
										<td><code>false</code></td>
									</tr>
									<tr>
										<td><code>String</code></td>
										<td><code>string</code></td>
										<td>A value of type <code>string</code></td>
										<td>The value of the next argument</td>
										<td><code>undefined</code></td>
									</tr>
									<tr>
										<td><code>Number</code></td>
										<td><code>number</code></td>
										<td>A value of type <code>number</code></td>
										<td>The value of the next argument, interpreted as a number</td>
										<td><code>undefined</code></td>
									</tr>
									<tr>
										<td><code>jsh.file.Pathname</code></td>
										<td><code>jsh.file.Pathname</code></td>
										<td>A value of type <code>jsh.file.Pathname</code></td>
										<td>
											The value of the next argument, interpreted as a <code>jsh.file.Pathname</code>. If the
											next argument is an absolute path, the equivalent <code>jsh.file.Pathname</code> is
											returned. Otherwise, the next argument is interpreted as a path relative to the current
											working directory.
										</td>
										<td><code>undefined</code></td>
									</tr>
									<tr>
										<td>
											<code>getopts.ARRAY</code>(<i>type</i>) where <i>type</i> is <code>String</code>,
											<code>Number</code> or <code>jsh.file.Pathname</code>)
										</td>
										<td><code>Array</code> of applicable type</td>
										<td>(not applicable)</td>
										<td>
											The value of the next argument, interpreted as the applicable type. Arguments can be
											specified multiple times on the same command line by repeating the option.
										</td>
										<td>A zero-length array.</td>
									</tr>
								</table>
							</div>
						</li>
						<li class="value">
							<div class="name">arguments</div>
							<span class="type">Array of string</span>
							<span>
								The arguments that were not parsed, either because they were skipped, or because they were
								"values" (arguments not beginning with a dash) that did not follow an "option" (an argument
								beginning with a dash).
							</span>
						</li>
					</ul>
				</div>
				<script type="application/x.jsapi#tests" jsapi:id="jsh.script.getopts">
					var getopts = module.getopts;

					var t_0 = getopts(
						{
							options: {
								s: String
							},
						},
						[ "-s", "brilliant" ]
					);

					test( function() { return t_0.options.s == "brilliant" } );

					var t_1 = getopts(
						{
							options: {
								n: Number,
								s: String,
								b: Boolean
							}
						},
						[ "-s", "hello", "-b", "-n", "8" ]
					);

					test( function() { return t_1.options.n == 8; } );
					test( function() { return t_1.options.s == "hello"; } );
					test( function() { return t_1.options.b; } );

					var t_array = getopts(
						{
							options: {
								l: getopts.ARRAY( String ),
								b: Boolean,
								nob: Boolean,
								n: 8,
								s: "nodefault",
							}
						},
						[ "-s", "sizzle", "-l", "hello", "-l", "world", "-b" ]
					);

					test( function() { return t_array.options.l.length == 2; } );
					test( function() { return t_array.options.l[0] == "hello"; } );
					test( function() { return t_array.options.l[1] == "world"; } );
					test( function() { return t_array.options.s == "sizzle"; } );
					test( function() { return t_array.options.b; } );
					test( function() { return !t_array.options.nob; } );
					test( function() { return t_array.options.n == 8; } );

					var usingArgumentsObject = (function() {
						return module.getopts({
							options: {
								a: String
							}
						}, arguments);
					})("-a", "b");
					test(usingArgumentsObject.options.a == "b");

					//
					//	Deprecated usage
					//

					var t_d_1 = getopts(
						{
							options: {
								s: String
							},
						},
						[ "-s", "yes" ]
					);

					test( function() { return t_d_1.options.s == "yes" } );

					var PATHNAME_SEPARATOR = context.$filesystem.$unit.getPathnameSeparator();
					var anAbsolute = PATHNAME_SEPARATOR + [ "hello", "world" ].join(PATHNAME_SEPARATOR);
					var pathsOptions = getopts({
							options: {
								absolute: context.FILE.Pathname,
								relative: context.FILE.Pathname
							}
						},
						[ "-absolute", anAbsolute, "-relative", "hello" ]
					);
					test( pathsOptions.options.absolute.toString().match(/([A-Z]\:)?(.*)/)[2] == anAbsolute );
					test( pathsOptions.options.relative.toString() == context.FILE.workingDirectory.toString() + "hello" );

				</script>
			</li>
		</ul>
	</div>
</body>
</html>