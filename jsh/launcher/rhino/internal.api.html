<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

The Original Code is the jsh JavaScript/Java shell.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2012-2013 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>jsh Launcher</title>
	<link rel="stylesheet" type="text/css" href="../../../loader/api/api.css"></link>
	<script type="text/javascript" src="../../../loader/api/api.js"></script>
	<!--	TODO	document directives	-->
</head>
<body>
	<div>
		<div>
			The <code>jsh</code> launcher starts a <code>jsh</code> shell that runs a main script.
		</div>
		<div>
			A shell may be <i>built</i> or <i>unbuilt</i>. An unbuilt shell is run directly from the SLIME source code, while a
			built shell is produced via the <code>jsh</code> installer.
		</div>
		The launcher consists of the following components:
	</div>
	<div>
		<h1>Bootstrap launcher</h1>
		<div>
			The bootstrap launcher prepares the Java launcher for execution.
		</div>
		<div>
			<h2>Responsibilities</h2>
			<ul>
				<li>If running an unbuilt shell, it compiles the launcher classes.</li>
				<li>
					If running on Rhino, sets the <code>jsh.engine.rhino.classpath</code> to the location from which Rhino was
					loaded.
				</li>
				<li>
					If running an unbuilt shell, sets the <code>jsh.shell.src</code> property to let the Java launcher know
					where to find the code.
				</li>
				<li>
					Select the appropriate Java implementation to use if the <code>jsh.java.home</code> setting is specified.
				</li>
				<li>
					Set appropriate specified VM arguments on the launcher VM, and pass appropriate specified VM arguments to the
					launcher as arguments for the loader VM.
				</li>
			</ul>
		</div>
		<div>
			<div>
				The bootstrap launcher will scan the arguments list for arguments with a leading dash, and interpret those as VM
				arguments to be sent to the container running the script being invoked. If the container is a classloader, these
				will be sent as VM arguments to the launcher VM; otherwise, they will be sent to the launcher as leading arguments
				to be passed to the loader VM.
			</div>
			<!--	TODO	should download Rhino if needed	-->
		</div>
	</div>
	<div>
		<h1>Java launcher (inonit.script.jsh.launcher.Main)</h1>
		<div>
			The Java launcher provides the normal entry point for running a <code>jsh</code> script. In theory, it could be
			combined with the bootstrap launcher (which could be modified to detect a built shell), but providing the main jsh file
			as an executable JAR file makes it more convenient to execute than invoking the bootstrap launcher (which is in turn
			invoked by/requires another script).
		</div>
		<div>
			The Java launcher also can, if invoked with the <code>-engines</code> argument (and that argument alone), provide a
			list of JavaScript engines that the launcher is capable of using.
		</div>
		<div>
			<h2>Settings used</h2>
			<table>
				<thead>
					<tr>
						<th>Name</th>
						<th>Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>jsh.shell.src</td>
						<td>
							If this is an unbuilt shell, the launcher needs to know where the root directory
							of the SLIME source code is.
						</td>
					</tr>
					<tr>
						<td>jsh.launcher.debug</td>
						<td>
							If this is present, and Rhino is used to execute the launcher script, then the
							launcher script will be executed in the Rhino debugger.
						</td>
					</tr>
					<tr>
						<td>jsh.engine</td>
						<td>
							If specified, will override the default mechanism for selecting a JavaScript engine
							and use the specified value.
						</td>
					</tr>
					<tr>
						<td>jsh.engine.rhino.classpath</td>
						<td>
							If specified, will override the default mechanism for locating Rhino.
						</td>
					</tr>
			</table>
			<h2>Responsibilities</h2>
			<!--	See Main.java	-->
			<ul>
				<li>
					Configure Java default logging properties.
				</li>
				<li>
					Determine what kind of shell is being run, and put a <code>inonit.script.jsh.launcher</code> instance in
					the <code>jsh.launcher.shell</code> system property. This instance contains information about the locations of
					Rhino, the packaged file (if any), and the shell home (if any). The shell is determined by checking for the
					<code>main.jsh.js</code> resource in the classloader (indicating a packaged shell), and then by checking
					whether the launcher main class was loaded from <code>jsh.jar</code> (indicating a built shell). Otherwise
					an unbuilt shell is being run.
				</li>
				<li>
					Invoke the launcher script.
				</li>
			</ul>
		</div>
		<div>
			<h1>Launcher script</h1>
			<div>
				<h2>api.js</h2>
				<div>
					TODO	See link
				</div>
			</div>
			<div>
				<h2>slime.js</h2>
				<div>
				</div>
			</div>
			<div>
				<h2>launcher.js</h2>
			</div>
		</div>
	</div>
</body>
</html>