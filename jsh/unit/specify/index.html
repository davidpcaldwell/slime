<!DOCTYPE html>
<html>
	<head>
		<title>Specification Editor</title>
		<style>
			#target { width: 100%; height: 90vh; }
		</style>
		<script src="../../../loader/browser/client.js"></script>
		<script>
			window.addEventListener('load', function() {
				//	TODO	CORS
				document.domain = document.domain;

				var xhr = new XMLHttpRequest();
				xhr.open("GET","../../../../$reload",false);
				xhr.send();
				
				var xhr = new XMLHttpRequest();
				xhr.open("GET","../../../../",false);
				xhr.send();
				var settings = JSON.parse(xhr.responseText);

				var react = function(f) {
					return function() {
						var iframe = document.getElementById("target");
						var content = iframe.contentDocument;
						f(iframe,content);
					};
				}

				var resize = react(function(iframe,content) {
					//	TODO	does not work
					iframe.height = content.height;
				});

				var title = react(function(iframe,content) {
					document.getElementById("title").innerHTML = content.title;
				});

				document.getElementById("target").addEventListener("load", function(e) {
					resize();
					title();
				});

				document.getElementById("target").src = window.location + "../../../../../../filesystem/" + settings.api.substring(1);

				var base = inonit.loader.base.split("/").slice(0,-3).join("/") + "/";

				if (settings.debug) {
					var loader = new inonit.loader.Loader(base);
					loader.run("slime/jsh/unit/specify/index.html.test.js", {
						$loader: new loader.Child("slime/")
					});
				}
			});
		</script>
	</head>
	<body>
		<div>Your specification</div>
		<div>
			<h1 id="title"></h1>
			<iframe id="target"></iframe>
		</div>
	</body>
</html>
