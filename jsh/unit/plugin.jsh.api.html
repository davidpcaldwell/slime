<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.


The Original Code is the jsh JavaScript/Java shell.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2015 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
	<head>
		<title>jsh.unit</title>
		<link href="../../loader/api/api.css" rel="stylesheet" type="text/css" />
		<script src="../../loader/api/api.js"></script>
	</head>
	<body>
		<div>
			Implementations of the various SLIME unit testing mechanisms, as well as tools for authoring unit tests (like mocks).
			The SLIME unit testing <a href="../../loader/api/unit.api.html">base</a> is loaded as <code>jsh.unit</code>, and the
			following APIs are added to it.
		</div>
		<div>(<a href="api.html">Older, semi-obsolete documentation</a>)</div>
		<div>
			<h1>Context</h1>
			<ul>
			</ul>
		</div>
		<div>
			<h1>Exports</h1>
			<div>
				<h2><code>jsh.unit.part</code></h2>
				<div class="label">has properties:</div>
				<ul>
					<li class="constructor">
						<div class="name">Html</div>
						<span>__DESCRIPTION__</span>
						<div>
							Executes the page, with the following added to the scope:
							<div class="label">has properties:</div>
							<ul>
								<li class="object">
									<!--	This stuff is defined in html.js	-->
									<div class="name">$jsapi</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="object">
											<div class="name">environment</div>
											<span>__DESCRIPTION__</span>
											<div class="label">has properties:</div>
											<ul>
											</ul>
										</li>
										<li class="object">
											<div class="name">loader</div>
											<span>
												In addition to the <a href="../../loader/api/api.html">standard properties</a>, the
												object supports the following interface:
											</span>
											<div class="label">has properties:</div>
											<ul>
												<li class="function">
													<div class="name">run</div>
													<span>__DESCRIPTION__</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
														</ol>
													</div>
													<div class="returns">
														<div class="label">Returns</div>
														<span class="type">__TYPE__</span>
														<span>__DESCRIPTION__</span>
													</div>
												</li>
												<li class="function">
													<div class="name">get</div>
													<span>__DESCRIPTION__</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
														</ol>
													</div>
													<div class="returns">
														<div class="label">Returns</div>
														<span class="type">__TYPE__</span>
														<span>__DESCRIPTION__</span>
													</div>
												</li>
												<li class="function">
													<div class="name">plugins</div>
													<span>__DESCRIPTION__</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
															<li class="value">
																<span class="type">string</span>
																<span>
																	(optional) A path relative to the definition page
																</span>
															</li>
														</ol>
													</div>
												</li>
												<li class="function">
													<div class="name">suite</div>
													<span>__DESCRIPTION__</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
														</ol>
													</div>
													<div class="returns">
														<div class="label">Returns</div>
														<span class="type">__TYPE__</span>
														<span>__DESCRIPTION__</span>
													</div>
												</li>
												<li class="function">
													<div class="name">getRelativePath</div>
													<span>__DESCRIPTION__</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
														</ol>
													</div>
													<div class="returns">
														<div class="label">Returns</div>
														<span class="type">__TYPE__</span>
														<span>__DESCRIPTION__</span>
													</div>
												</li>
											</ul>
										</li>
										<li class="object">
											<div class="name">debug</div>
											<span>__DESCRIPTION__</span>
											<div class="label">has properties:</div>
											<ul>
												<li class="function deprecated">
													<div class="name">disableBreakOnExceptions</div>
													<span>
														Returns a function that disables the debugger's break-on-exception behavior for the duration of the
														function.
													</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
															<li class="value">
																<span class="type">function</span>
																<span>A function</span>
															</li>
														</ol>
													</div>
													<div class="returns">
														<div class="label">Returns</div>
														<span class="type">function</span>
														<span>A function with identical behavior, except it does not break on exceptions in the debugger.</span>
													</div>
												</li>
											</ul>
										</li>
										<li class="object">
											<div class="name">file</div>
											<span>__DESCRIPTION__</span>
											<div class="label">has properties:</div>
											<ul>
												<li class="deprecated function">
													<div class="name">newTemporaryDirectory</div>
													<span>
														<b>Deprecated. <i>Use <code>jsh.shell.TMPDIR.createTemporary({ directory: true })</code></i></b>
														Creates a temporary directory.
													</span>
													<div class="returns">
														<div class="label">Returns</div>
														<span class="type"><a href="../../rhino/file/api.html#types.directory">directory</a></span>
														<span>A new temporary directory.</span>
													</div>
												</li>
											</ul>
										</li>
										<li class="object">
											<div class="name">java</div>
											<span>__DESCRIPTION__</span>
											<div class="label">has properties:</div>
											<ul>
												<li class="value">
													<div class="name">loader</div>
													<span class="type">__TYPE__</span>
													<span>__DESCRIPTION__</span>
												</li>
												<li class="object">
													<div class="name">io</div>
													<span>__DESCRIPTION__</span>
													<div class="label">has properties:</div>
													<ul>
														<li class="function">
															<div class="name">newTemporaryDirectory</div>
															<span>
																Returns a <code>java.io.File</code> representing a new, empty directory.
															</span>
															<div class="returns">
																<div class="label">Returns</div>
																<span class="type">JavaClass java.io.File</span>
																<span>__DESCRIPTION__</span>
															</div>
														</li>
													</ul>
												</li>
											</ul>
										</li>
									</ul>
								</li>
							</ul>
						</div>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<div class="name">__NAME__</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">name</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">pathname</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">environment</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">reload</div>
											<span class="type">boolean</span>
											<span>__DESCRIPTION__</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
						<script type="application/x.jsapi#initialize">
							if (!$jsapi.environment.file) {
								//	TODO	this is grotesque but probably will work for now
								$jsapi.environment.file = jsh.shell.jsh.src.getFile("jsh/unit/plugin.jsh.api.html");
							}
						</script>
						<script type="application/x.jsapi#tests">
							var suite = new jsh.unit.Suite({
								parts: {
									reload: new jsh.unit.part.Html({
										reload: true,
										pathname: $jsapi.environment.file.parent.getRelativePath("test.api.html")
									}),
									static: new jsh.unit.part.Html({
										pathname: $jsapi.environment.file.parent.getRelativePath("test.api.html")
									})
								}
							});
							verify(Object.keys(suite.parts)).length.is(2);
							var staticPart = verify(suite).evaluate(function() { return this.parts.static; });
							var reloadPart = verify(suite).evaluate(function() { return this.parts.reload; });
							staticPart.is.type("object");
							staticPart.evaluate(function() { return this.parts; }).is.type("object");
							reloadPart.evaluate(function() { return this.parts; }).is.type("undefined");
							verify(suite).run().is(true);
						</script>
					</li>
				</ul>
			</div>
			<div>
				<h2><code><a href="../../loader/api/unit.api.html#exports.Scenario">jsh.unit.Scenario</a></code></h2>
				<div class="label">has properties:</div>
				<ul>
					<li class="constructor">
						<div class="name">Events</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
					</li>
					<li class="constructor">
						<div class="name">Stream</div>
						<span>Creates a scenario which executes by reading events from a stream.</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<div class="name">__NAME__</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">name</div>
											<span class="type">string</span>
											<span>The name to use for the remote scenario.</span>
										</li>
										<li class="value">
											<div class="name">stream</div>
											<span class="type"><a href="../../rhino/io/api.html#types.binput">byte input stream</a></span>
											<span>A stream broadcasting events using the <code>jsh.unit.view.Events</code> protocol.</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<!--	TODO	scenario type not properly defined yet	-->
							<span class="type">scenario</span>
							<!--
							<span>__DESCRIPTION__</span>
							-->
						</div>
					</li>
					<li class="constructor">
						<div class="name">Html</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">pathname</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">unit</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">environment</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
							<span>Returns a Suite</span>
						</div>
					</li>
				</ul>
			</div>
			<div>
				<!--	TODO	link below to correct fragment	-->
				<h2><code><a href="../../loader/api/unit.api.html">jsh.unit.Suite</a></code></h2>
				<div>
					The API for <code>Suite</code> is extended as follows.
				</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">Fork</div>
						<span>
							Creates a part that runs a program that supports the standard I/O protocol for communicating testing
							events.
						</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<span>
										An object containing properties specifying how to run the program.
									</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">name</div>
											<span class="type">string</span>
											<span>The part name to use for the program in the test suite.</span>
										</li>
										<li class="value">
											<div class="name">run</div>
											<span class="type">function</span>
											<div>
												The program launching implementation (taking a single argument) to be used when
												launching the program. The
												implementation will need to allow the specification of a buffer as the
												<code>stdio.output</code> property of the argument. Generally, this will be a value
												like:
												<ul>
													<li><code>jsh.shell.run</code></li>
													<li><code>jsh.shell.java</code></li>
													<li><code>jsh.shell.jsh</code></li>
												</ul>
												See the <a href="../../rhino/shell/plugin.jsh.api.html">jsh.shell</a> documentation
												for more details.
											</div>
										</li>
									</ul>
									<div>
										The properties argument passed to the <code>Fork</code> function may have other properties,
										and those properties will be passed to the <code>run</code> function.
									</div>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">part</span>
						</div>
					</li>
				</ul>
			</div>
			<div>
				<h2><code>jsh.unit.view</code></h2>
				<div class="label">has properties:</div>
				<ul>
					<li class="constructor">
						<div class="name">Console</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<div class="name">__NAME__</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">writer</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
					</li>
					<li class="constructor">
						<div class="name">Events</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<div class="name">__NAME__</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">writer</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
					</li>
					<li class="constructor">
						<div class="name">WebView</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
					</li>
				</ul>
			</div>
			<div>
				<h2><code>jsh.unit.interface</code></h2>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">create</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">suite</span>
									<span>__DESCRIPTION__</span>
								</li>
								<li class="object">
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">view</div>
											<span class="type">string</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">path</div>
											<span class="type">__TYPE__</span>
											<span>__DESCRIPTION__</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
					</li>
				</ul>
			</div>
			<div>
				<h2><code>jsh.unit.mock</code></h2>
				<ul>
					<li class="constructor">
						<div class="name">Web</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
							</ol>
						</div>
						<div class="instances">
							<div class="label">Instances</div>
							<span class="type">__TYPE__</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="function">
									<div class="name">add</div>
									<span>__DESCRIPTION__</span>
									<div class="arguments">
										<div class="label">Arguments</div>
										<ol>
											<li class="value">
												<span class="type">handler</span>
												<span>__DESCRIPTION__</span>
											</li>
										</ol>
									</div>
								</li>
								<li class="value">
									<div class="name">client</div>
									<span class="type">jsh.http.Client</span>
									<span>A client that proxies all requests through this object.</span>
								</li>
							</ul>
						</div>
						<script type="application/x.jsapi#tests">
							var web = new jsh.unit.mock.Web();
							web.add(function(request) {
								if (request.headers.value("host") == "www.foo.com") {
									return {
										status: { code: 200 },
										body: {
											type: "application/json",
											string: JSON.stringify({ path: request.path })
										}
									}
								}
							});
							web.start();
							var client = web.client;
							var response = client.request({
								url: "http://www.foo.com/pathis",
								evaluate: function(response) {
									if (response.status.code != 200) {
										throw new Error();
									}
									return JSON.parse(response.body.stream.character().asString());
								}
							});
							verify(response).path.is("pathis");
							web.stop();
						</script>
					</li>
				</ul>
			</div>
			<script type="application/x.jsapi#tests">
				var remote = $jsapi.loader.file("remote.js", {
					api: {
						java: jsh.java
					}
				});
				verify(remote).is.not(void(0));
				var subscenario = new function() {
					this.name = "Sub";
					this.execute = function(scope) {
						scope.test(function() {
							return {
								success: true,
								message: "yes, we can"
							}
						});
					}
				}
				var scenario = new jsh.unit.Suite({
					name: "Target",
					execute: function(scope) {
						scope.test(function() {
							return {
								success: true,
								message: "it is true"
							}
						});
						scope.scenario(subscenario);
					}
				});
				var decoder = new jsh.unit.JSON.Decoder();
				var encoder = new jsh.unit.JSON.Encoder({
					send: function(e) {
						decoder.decode(e);
					}
				});
				encoder.listen(scenario);
				new jsh.unit.view.Console({
					writer: jsh.shell.stdio.output
				}).listen(scenario);
				var listener = new jsh.unit.Suite(new remote.Events({
					source: decoder
				}));
				scenario.run();
				new jsh.unit.view.Console({
					writer: jsh.shell.stdio.output
				}).listen(listener);
				listener.run();
			</script>
		</div>
	</body>
</html>