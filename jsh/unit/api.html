<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

The Original Code is the jsh JavaScript/Java shell.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2010-2013 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>jsapi</title>
	<link rel="stylesheet" type="text/css" href="../../loader/api/api.css"></link>
	<script type="text/javascript" src="../../loader/api/api.js"></script>
</head>
<body>
	<div>
		<script type="application/x.jsapi#initialize">
			if (!$jsapi.environment.file) {
				//	TODO	this is grotesque but probably will work for now
				$jsapi.environment.file = jsh.shell.jsh.src.getFile("jsh/unit/api.html");
			}
		</script>
		<script type="application/x.jsapi#tests">
			var suite = new jsh.unit.Suite({
				parts: {
					reload: new jsh.unit.part.Html({
						reload: true,
						pathname: $jsapi.environment.file.parent.getRelativePath("test.api.html")
					}),
					static: new jsh.unit.part.Html({
						pathname: $jsapi.environment.file.parent.getRelativePath("test.api.html")
					})
				}
			});
			verify(Object.keys(suite.parts)).length.is(2);
			var staticPart = verify(suite).evaluate(function() { return this.parts.static; });
			var reloadPart = verify(suite).evaluate(function() { return this.parts.reload; });
			staticPart.is.type("object");
			staticPart.evaluate(function() { return this.parts; }).is.type("object");
			reloadPart.evaluate(function() { return this.parts; }).is.type("undefined");
			verify(suite).run().is(true);
		</script>
		<h1>jsapi.jsh.js</h1>
		Command-line arguments
		<ul>
			<!--	TODO	use styles rather than italics to implement the below; perhaps a class commandarg or something	-->
			<li>(optional) <code>-jsapi <i>pathname</i></code> Location of <code>loader/api</code> directory</li>
			<li><code>-api <i>pathname</i></code> A file describing an API.</li>
			<li>
				<code>-test <i>&lt;pathname&gt;</i>:<i>&lt;test&gt;</i></code>
				<p>
					Adds a test to the list of tests to be run.
				</p>
				<p>
					The argument consists of a path to the API file, and, optionally, a test ID.
				</p>
			</li>
			<li><code>-notest</code> Skip unit tests. If this option is present, no tests will be run.</li>
			<li><code>-classpath <i>pathname</i></code> (Multiple allowed) Add <code><i>pathname</i></code> to the script classpath.</li>
			<li>
				<code>-environment <i>arg</i></code>
				Adds a value to the <code>$jsapi.environment</code> value provided to tests.
				<code>arg</code> can have one of two formats:
				<ul>
					<li>
						<code><i>name</i>=<i>value</i></code>: The variable <code>$jsapi.environment[<i>name</i>]</code> is set
						to the string <i>value</i>.
					</li>
					<li>
						<code><i>name</i>:<i>pathname</i></code>: The variable <code>$jsapi.environment[<i>name</i>]</code> is set
						to a module object loaded from <code><i>pathname</i></code>.
					</li>
					<li>
						<code><i>name</i></code>: The variable <code>$jsapi.environment[<i>name</i>]</code> is set to
						<code>new Object()</code>.
					</li>
				</ul>
			</li>
			<li><code>-doc</code> Pathname at which to create a directory to which to emit documentation; if option is missing, no
				documentation is emitted. If directory exists, it is deleted and re-created.
			</li>
			<li>
				<code>-index <i>pathname</i></code> File to be used as index file for documentation. If present, this file will
				be copied as <code>index.html</code> at the top-level of the documentation hierarchy (that is, into the directory
				specified by <code>-doc</code>).
			</li>
		</ul>
	</div>
	<div>
		<h1>api.html</h1>
		<div>
			<h2>Unit Tests</h2>
			<div>
				See the documentation on the <a href="../../loader/api/api.html">API format</a> for details on how files are
				processed for testing. The following objects are provided in the scope in which tests are executed.
			</div>
			<div>
				<div>
					<h3>$jsapi</h3>
					<div>
						See <a href="../../loader/api/api.html">loader</a> documentation.
					</div>
					<ul>
						<li class="function">
							<div class="name">newTemporaryDirectory</div>
							<span>Returns a new, empty directory.</span>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">jsh.file directory</span>
							</div>
						</li>
						<li class="function">
							<div class="name">disableBreakOnException</div>
							<span>
								Returns a function that disables the debugger's break-on-exception behavior for the duration of the
								function.
							</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="value">
										<span class="type">function</span>
										<span>A function</span>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">function</span>
								<span>A function with identical behavior, except it does not break on exceptions in the debugger.</span>
							</div>
						</li>
						<li class="object">
							<div class="name">environment</div>
							<span>__DESCRIPTION__</span>
							<div class="label">has properties:</div>
							<ul>
							</ul>
						</li>
						<li class="object">
							<div class="name">java</div>
							<span>__DESCRIPTION__</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="object">
									<div class="name">io</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="function">
											<div class="name">newTemporaryDirectory</div>
											<span>
												Returns a <code>java.io.File</code> representing a new, empty directory.
											</span>
											<div class="returns">
												<div class="label">Returns</div>
												<span class="type">JavaClass java.io.File</span>
												<span>__DESCRIPTION__</span>
											</div>
										</li>
									</ul>
								</li>
							</ul>
						</li>
					</ul>
				</div>
				<h3>$unit</h3>
				<ul>
					<li class="value">
						<div class="name">context</div>
						<span class="type">object</span>
						<span>The <code>$context</code> that was used when instantiating the module to run the current set of tests.</span>
					</li>
				</ul>
				<h3>$module</h3>
				<ul>
					<li class="function">
						<div class="name">getResourcePathname</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">string</span>
									<span>__DESCRIPTION__</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<div>
			<h2>Documentation</h2>
			<div>
				The documentation emitted by jsapi respects the <code jsapi:test="foo">jsapi:reference</code> attribute defined in the
				<a href="../../loader/api/api.html">loader API</a> documentation.
			</div>
		</div>
	</div>
</body>
</html>