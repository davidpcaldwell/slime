<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

The Original Code is the SLIME JDK interface.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2014 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>Mercurial</title>
	<link rel="stylesheet" type="text/css" href="../../../loader/api/api.css" />
	<script src="../../../loader/api/api.js"></script>
</head>
<body>
	<div>
		<h1>Context</h1>
		<ul>
			<li class="object">
				<div class="name">api</div>
				<span>__DESCRIPTION__</span>
				<div class="label">has properties:</div>
				<ul>
					<li class="value">
						<div class="name">js</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">web</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">java</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">io</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">ip</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">file</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">shell</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
					<li class="value">
						<div class="name">time</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</li>
				</ul>
			</li>
			<li class="value">
				<div class="name">install</div>
				<span class="type"><a href="../../../rhino/file/api.html#types.file">file</a></span>
				<span>A file representing the Mercurial executable.</span>
			</li>
		</ul>
	</div>
	<div>
		<h1>Exports</h1>
		<script type="application/x.jsapi#initialize">
			$jsapi.loader.plugins();
			scope.module = jsh.tools.hg;
			scope.module.unit = {
				Repository: function() {
					var rv = this;
					rv.unit = new function() {
						this.createFile = function(p) {
							rv.directory.getRelativePath(p.path).write(p.content, { append: false });
							if (p.add) {
								rv.add({ files: [rv.directory.getRelativePath(p.path).toString()] });
							}
							return rv.directory.getFile(p.path);
						};

						this.editFile = function(p) {
							var edited = rv.directory.getFile(p.path).read(String);
							if (typeof(p.content) == "string") {
								edited = p.content;
							} else if (typeof(p.edit) == "function") {
								edited = p.edit(edited);
							}
							rv.directory.getRelativePath(p.path).write(edited, { append: false });
						};

						this.readFile = function(p) {
							if (typeof(p) == "string") {
								p = { path: p };
							}
							return rv.directory.getFile(p.path).read(String);
						};

						this.clone = function(p) {
							var cloned = rv.clone(p);
							scope.module.unit.Repository.call(cloned);
							return cloned;
						}
					}
				}
			};
			var createHg = function() {
				var rv = scope.module.init(jsh.shell.TMPDIR.createTemporary({ directory: true }));
				scope.module.unit.Repository.call(rv);
				return rv;
			};
			scope.createHg = createHg;
		</script>
		<script type="application/x.jsapi#initialize">
			scope.a = scope.createHg();
		</script>
		<div class="type">
			<a class="type" name="types.changeset">changeset</a>
			<span>A single Mercurial changeset from a <a href="#types.Repository">Repository</a>.</span>
			<div class="label">has properties:</div>
			<ul>
				<li class="object">
					<div class="name">changeset</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="value">
							<div class="name">local</div>
							<span class="type">number</span>
							<span>The local changeset number.</span>
						</li>
						<li class="value">
							<div class="name">global</div>
							<span class="type">string</span>
							<span>A global changeset ID.</span>
						</li>
					</ul>
				</li>
			</ul>
		</div>
		<div class="type">
			<a class="type" name="types.Repository">Repository</a>
			<span>__DESCRIPTION__</span>
			<div class="label">has properties:</div>
			<ul>
				<li class="value">
					<div class="name">reference</div>
					<span class="type">string</span>
					<span>A value that can be used to refer to this repository in a Mercurial command.</span>
				</li>
				<li class="function">
					<div class="name">clone</div>
					<span>Clones this repository into the specified directory.</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">to</div>
										<span class="type"><a href="../../../rhino/file/api.html#types.directory">directory</a></span>
										or
										<span class="type"><a href="../../../rhino/file/api.html#types.Pathname">Pathname</a></span>
										<span>
											A destination. If the destination is a Pathname and the directory does not exist, it will be
											created (but its parent directory must exist).
										</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type"><a href="#types.LocalRepository">LocalRepository</a></span>
						<span>The newly created repository.</span>
					</div>
					<script type="application/x.jsapi#tests">
						//	TODO	add test for pathname scenario
						var b = a.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						var c = a.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }).pathname);
						var to = jsh.shell.TMPDIR.createTemporary({ directory: true }).pathname;
						to.directory.remove();
						test(!to.directory);
						var d = a.clone(to);
						test(Boolean(to.directory));
						test(1 == 1, "Clone succeeded");
					</script>
				</li>
				<li class="function">
					<div class="name">identify</div>
					<span>Returns information about a repository, including its current revision.</span>
					<div class="returns">
						<div class="label">Returns</div>
						<div class="label">has properties:</div>
						<ul>
							<li class="value">
								<div class="name">changeset</div>
								<span class="type"><a href="#types.changeset">changeset</a></span>
								<span>Changeset for the current revision.</span>
							</li>
							<li class="value">
								<div class="name">modified</div>
								<span class="type">boolean</span>
								<span>
									(conditional: if repository is local)
									Whether the working directory has uncommitted changes.
								</span>
							</li>
						</ul>
					</div>
					<!--	TODO	add test case for remote repository	-->
					<script type="application/x.jsapi#tests">
						var local = createHg();
						var id = local.identify();
						test(Boolean(id.changeset.global));
						local.directory.getRelativePath("a").write("1\n", { append: false });
						local.commit({ addremove: true, message: "a:1" });
						var id1 = local.identify();
						var copy = local.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						local.directory.getRelativePath("b").write("1\n", { append: false });
						local.commit({ addremove: true, message: "b:1" });
						copy.pull(local);
						(function() {
							var copyid = copy.identify();
							test(copyid.changeset.global == id1.changeset.global);
						})();
						copy.directory.getRelativePath("a").write("2\n", { append: true });
						(function() {
							var copyid = copy.identify();
							test(copyid.changeset.global == id1.changeset.global);
							test(copyid.modified);
						})();
					</script>
				</li>
			</ul>
		</div>
		<div class="type">
			<a class="type" name="types.__NAME__">RemoteRepository</a>
			<span class="type">supports <a href="#types.Repository">Repository</a></span>
			<span>__DESCRIPTION__</span>
			<div class="label">has properties:</div>
			<ul>
				<li class="value">
					<div class="name">url</div>
					<span class="type"><a href="../../../js/web/api.html">Url</a></span>
					<span>__DESCRIPTION__</span>
				</li>
			</ul>
		</div>

		<div class="type">
			<a class="type" name="types.LocalRepository">LocalRepository</a>
			<span class="type">supports <a href="#types.Repository">Repository</a></span>
			<span>A local Mercurial repository.</span>
			<div class="label">has properties:</div>
			<ul>
				<li class="value">
					<div class="name">directory</div>
					<span class="type"><a href="../../../rhino/file/api.html#types.directory">directory</a></span>
					<span>The root directory of this <code>Repository</code>.</span>
				</li>
				<li class="value">
					<div class="name">paths</div>
					<span class="type">object</span>
					<span>
						Each property of this object represents a path returned by the <code>hg paths</code> command. The
						name of the property is the name of the path, and the value is the
						<a href="#types.Repository">Repository</a> represented by the path.
					</span>
					<script type="application/x.jsapi#tests">
						var repository = module.init(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						var other = repository.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						test(Boolean(other.paths["default"].directory));
						test(other.paths["default"].directory.toString() == repository.directory.toString());
					</script>
				</li>
				<li class="function">
					<div class="name">outgoing</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<div class="name">__NAME__</div>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">destination</div>
										<span class="type">
											<a href="#types.Repository">Repository</a>
										</span>
										-OR-
										<span class="type">string</span>
										<span>
											(optional)
											The repository, or URL of a remote repository, to which to compare this one. If unspecified,
											the Mercurial default will be used.
										</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">Array of <a href="#types.changeset">changeset</a></span>
						<span>__DESCRIPTION__</span>
					</div>
					<script type="application/x.jsapi#tests">
						var first = a.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						var second = first.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						test(second.outgoing(first).length == 0);
						second.directory.getRelativePath("hello.txt").write("Hello");
						test(second.outgoing(first).length == 0);
						second.commit({ addremove: true, message: "commit message" });
						test(second.outgoing(first).length == 1);
					</script>
				</li>
				<li class="function">
					<div class="name">incoming</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">push</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<div class="name">__NAME__</div>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">config</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">stdio</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">force</div>
										<span class="type">boolean</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">revision</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">destination</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">pull</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">log</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">revision</div>
										<span class="type">string</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">heads</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">Array of <a href="#types.changeset">changeset</a></span>
						<span>__DESCRIPTION__</span>
					</div>
					<script type="application/x.jsapi#tests">
						var repository = module.init(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						repository.directory.getRelativePath("baz").write("baz", { append: false });
						repository.commit({ addremove: true, message: "baz" });
						var other = repository.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
						repository.directory.getRelativePath("foo").write("foo", { append: false });
						repository.commit({ addremove: true, message: "foo" });
						other.directory.getRelativePath("bar").write("bar", { append: false });
						other.commit({ addremove: true, message: "bar" });
						other.pull({
							source: repository
						});
						test(other.heads().length == 2);
						debugger;
					</script>
				</li>
				<li class="function">
					<div class="name">tip</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">parents</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">archive</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function" jsapi:id="subrepositories">
					<div class="name">subrepositories</div>
					<span>Returns a list of each of this repository's subrepositories.</span>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">Array of <a href='#types.LocalRepository'>LocalRepository</a></span>
						<span>
							The subrepositories, or <code>null</code> if this repository has no <code>.hgsub</code>. If a directory
							does not exist for a declared subrepository, an error will be thrown.
						</span>
					</div>
					<script type="application/x.jsapi#tests">
						var pathname = jsh.shell.TMPDIR.createTemporary({ directory: true }).pathname;
						var parent = module.init({ pathname: pathname });
						var child = module.init({ pathname: pathname.directory.getRelativePath("child") });
						pathname.directory.getRelativePath(".hgsub").write("child = child\n", { append: false });
						var subrepositories = parent.subrepositories({ array: true });
						verify(subrepositories).length.is(1);
						verify(subrepositories)[0].directory.toString().is(pathname.directory.getSubdirectory("child").toString());

						subrepositories = parent.subrepositories();
						verify(subrepositories).evaluate.property("child").is.type("object");
						verify(subrepositories).evaluate.property("foo").is.type("undefined");
					</script>
				</li>
				<li class="function">
					<div class="name">status</div>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">subrepos</div>
										<span class="type">boolean</span>
										<span>
											(optional; if omitted, will be <code>true</code> if subrepositories are directed, and
											<code>false</code> otherwise)
											If <code>true</code>, the status information for subrepositories will be included. If
											<code>false</code>, it will be omitted.
										</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						An object with properties representing each file that has a status. The names of these properties
						are the relative paths of the files from the root, and the values are the values of the status.
					</div>
					<script type="application/x.jsapi#tests">
						a.directory.getRelativePath("1.txt").write("Hello");
						a.directory.getRelativePath("2/2.txt").write("Hello", {recursive: true});
						var rv = a.status();
						test(rv["1.txt"] == "?");
						test(rv["2/2.txt"] == "?");
						test(rv["3.txt"] != "?");
					</script>
				</li>
				<li class="function">
					<div class="name">add</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">update</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">revision</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">merge</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">revision</div>
										<span class="type">string</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
				<li class="function">
					<div class="name">commit</div>
					<span>Commit changes from the working directory to the repository.</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">addremove</div>
										<span class="type">boolean</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">message</div>
										<span class="type">string</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">files</div>
										<span class="type">Array of string</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
					<script type="application/x.jsapi#tests">
						var repository = createHg();
						repository.directory.getRelativePath("1").write("1\n", { append: false });
						try {
							repository.commit({ message: "1" });
							test(false);
						} catch (e) {
							//	TODO	ensure that the failure is the correct one
							var error = e;
							debugger;
							test(true);
						}
						repository.commit({ addremove: true, message: "1" });
					</script>
				</li>
				<li class="function" jsapi:id="bookmarks">
					<div class="name">bookmarks</div>
					<div class="type">
						<a class="type" name="types.bookmark">bookmark</a>
						<span>__DESCRIPTION__</span>
						<div class="label">has properties:</div>
						<ul>
							<li class="value">
								<div class="name">name</div>
								<span class="type">string</span>
								<span>The name of the bookmark</span>
							</li>
							<li class="value">
								<div class="name">active</div>
								<span class="type">boolean</span>
								<span>__DESCRIPTION__</span>
							</li>
							<li class="value">
								<div class="name">changeset</div>
								<span class="type"><a href="#types.changeset">changeset</a></span>
								<span>__DESCRIPTION__</span>
							</li>
						</ul>
					</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<div class="name">__NAME__</div>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">get</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">set</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						If querying the bookmarks, array of the following type:
						<div class="label">has properties:</div>
						<ul>
						</ul>
					</div>
					<script type="application/x.jsapi#tests">
						var parent = createHg();
						parent.unit.createFile({ path: "a", content: "1", add: true });
						parent.commit({ message: "1" });
						verify(parent).bookmarks.get("created").is(null);
						parent.bookmarks({ name: "created" });
						verify(parent).bookmarks.get("created").is.type("object");
						verify(parent).evaluate(function() { return this.bookmarks({ delete: true }); }).threw.type(Error);
						parent.bookmarks({ delete: true, name: "created" });
						verify(parent).bookmarks.get("created").is(null);						
					</script>
					<script type="application/x.jsapi#tests">
						var parent = createHg();
						parent.unit.createFile({ path: "a", content: "1", add: true });
						parent.commit({ message: "1" });
						parent.bookmarks({ name: "@" });
						parent.bookmarks({ name: "local" });
						var at = parent.bookmarks.get("@");
						var local = parent.bookmarks.get("local");
						verify(at).changeset.global.is(local.changeset.global);
						verify(at).active.is(false);
						verify(local).active.is(true);
						verify(parent).bookmarks.get("foo").is(null);
					</script>
					<div>
						<div>Tests for deprecated APIs</div>
						<script type="application/x.jsapi#tests">
							var parent = createHg();
							parent.unit.createFile({ path: "a", content: "1", add: true });
							parent.commit({ message: "1" });
							parent.bookmarks({ name: "@" });
							parent.bookmarks({ name: "local" });
							verify(parent).bookmarks()["@"].active.is(false);
							verify(parent).bookmarks()["local"].active.is(true);
							parent.unit.editFile({ path: "a", content: "2" });
							parent.commit({ message: "2" });

							//	Test that @ is current revision
							var child = parent.unit.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
							verify(child).unit.readFile("a").is("1");
							//	TODO	this kind of access of bookmark by name is not documented
							verify(child).bookmarks()["@"].active.is(true);
							verify(child).bookmarks()["local"].active.is(false);
						</script>
						<script type="application/x.jsapi#tests">
							var parent = createHg();
							parent.unit.createFile({ path: "a", content: "1", add: true });
							parent.commit({ message: "1" });
							parent.bookmarks({ name: "@" });
							var child = parent.unit.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
							verify(child).bookmarks().evaluate.property("@").is.type("object");
							verify(child).bookmarks()["@"].active.is(true);
							verify(child).bookmarks().evaluate.property("local").is.type("undefined");

							parent.bookmarks({ name: "local" });
							parent.unit.editFile({ path: "a", content: "2" });
							parent.commit({ message: "2" });
							verify(child).unit.readFile("a").is("1");
							child.pull({ source: parent });
							verify(child).bookmarks().evaluate.property("local").is.type("object");
						</script>
						<script type="application/x.jsapi#tests">
							var parent = createHg();
							parent.unit.createFile({ path: "a", content: "1", add: true });
							parent.commit({ message: "1" });
							parent.bookmarks({ name: "@" });

							var child = parent.unit.clone(jsh.shell.TMPDIR.createTemporary({ directory: true }));
							verify(child).bookmarks().evaluate.property("@").is.type("object");
							verify(child.bookmarks()["@"].active);

							verify(parent).bookmarks().evaluate.property("local").is.type("undefined");
							verify(child).bookmarks().evaluate.property("local").is.type("undefined");
							child.bookmarks({ name: "local" });
							child.unit.editFile({ path: "a", content: "2" });
							child.commit({ message: "2" });
							verify(parent).unit.readFile("a").is("1");
							child.push({ destination: parent });
							verify(parent).bookmarks().evaluate.property("local").is.type("undefined");
							verify(child).bookmarks().evaluate.property("local").is.type("object");
						</script>
					</div>
				</li>
				<li class="function">
					<div class="name">serve</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
					<script type="application/x.jsapi#tests">
						var parent = createHg();
						parent.unit.createFile({ path: "a", content: "a", add: true });
						parent.commit({ message: "a" });
						var server = parent.serve({ port: 0 });
						verify(server).is.type("object");
						verify(server).port.is.type("number");
						var tmpclone = jsh.shell.TMPDIR.createTemporary({ directory: true });
						var remote = new module.Repository({ url: "http://127.0.0.1:" + server.port + "/" });
						var local = remote.clone(tmpclone);
						var commits = local.log();
						verify(commits).length.is(1);
						server.kill();
						verify("killed").is("killed");
					</script>
				</li>
				<li class="function">
					<div class="name">shell</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<div class="name">__NAME__</div>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">command</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">arguments</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
									<li class="value">
										<div class="name">config</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
				</li>
			</ul>
		</div>
		<!--
		<div class="type">
			<a class="type" name="types.RemoteRepository">RemoteRepository</a>
			<span class="type">supports <a href="#types.Repository">Repository</a></span>
			<span>A remote Mercurial repository</span>
			<div class="label">has properties:</div>
			<ul>
			</ul>
		</div>
		-->
		<ul>
			<li class="constructor">
				<div class="name">Installation</div>
				<span>__DESCRIPTION__</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="object">
							<span>__DESCRIPTION__</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">install</div>
									<span class="type"><a href="../../../rhino/file/api.html#types.file">file</a></span>
									<span>A Mercurial executable.</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
				<div class="instances">
					<div class="label">Instances</div>
					<span class="type">__TYPE__</span>
					<span>__DESCRIPTION__</span>
				</div>
			</li>
			<li class="constructor">
				<div class="name">Repository</div>
				<span>Creates an object representing a Mercurial repository given its location.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="object">
							<span>An argument describing a local repository.</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">directory</div>
									<span class="type"><a href="../../../rhino/file/api.html#types.directory">directory</a></span>
									<span>The location of the repository.</span>
								</li>
							</ul>
							-or-
							<span>An argument describing a remote repository.</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">url</div>
									<span class="type">string</span>
									<span>The location of the repository</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
				<div class="instances">
					<div class="label">Instances</div>
					<span class="type"><a href="#types.Repository">Repository</a></span>
				</div>
			</li>
			<li class="function">
				<div class="name">init</div>
				<span>Creates a local Mercurial repository.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="object">
							<span>__DESCRIPTION__</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">pathname</div>
									<!--	TODO	verify Pathname link	-->
									<span class="type"><a href="../../../rhino/file/api.html#types.Pathname">Pathname</a></span>
									<span>The location at which to create the repository.</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
				<div class="returns">
					<div class="label">Returns</div>
					<span class="type"><a href="#types.LocalRepository">LocalRepository</a></span>
				</div>
				<script type="application/x.jsapi#tests">
					var init = jsh.shell.TMPDIR.createTemporary({ directory: true });
					init.getRelativePath("foo").write("foo", { append: false });
					var repository = module.init({ pathname: init.pathname });
					repository.commit({ addremove: true, message: "test" });
					verify(repository).directory.pathname.toString().is(init.pathname.toString());
					//	TODO	add log command and test based on its result
				</script>
			</li>
			<li class="constructor" jsapi:id="Hgrc">
				<div class="name">Hgrc</div>
				<span>A Mercurial configuration file.</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="object">
							<span>__DESCRIPTION__</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">file</div>
									<span class="type"><a href="../../file/api.html#types.file">file</a></span>
									<span>The file to parse.</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
				<div class="instances">
					<div class="label">Instances</div>
					<span class="type">__TYPE__</span>
					<span>__DESCRIPTION__</span>
				</div>
				<script type="application/x.jsapi#tests"><![CDATA[
					var dir = jsh.shell.TMPDIR.createTemporary({ directory: true });
					dir.getRelativePath("1.hgrc").write($jsapi.loader.string("test/1.hgrc"), { append: false });
					//	Can't find easy way to write enough automated tests here; maybe just laziness?
					var hgrc = new module.Hgrc({ file: dir.getFile("1.hgrc") });
					var LENGTH = 29;
					verify(hgrc,"1.hgrc").get("ui.username").is("I use it <iuseit@aol.com>");
					verify(hgrc,"1.hgrc").unit.lines.length.is(LENGTH);
					hgrc.set("ui","username","I also use it");
					verify(hgrc,"1.hgrc").get("ui.username").is("I also use it");
					verify(hgrc,"1.hgrc").unit.lines.length.is(LENGTH+2);
					hgrc.normalize();
					//	Should remove the duplicate header
					verify(hgrc,"1.hgrc").unit.lines.length.is(LENGTH-1);
					verify(hgrc,"1.hgrc").get("ui.username").is("I also use it");
				]]></script>
			</li>
		</ul>
	</div>
</body>
</html>