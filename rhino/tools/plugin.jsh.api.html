<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.


The Original Code is the SLIME JDK interface.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2017 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
	<head>
		<title>jsh.java.tools</title>
		<!--	TODO	change these to use local copies of these files at the appropriate location	-->
		<!--
			These files are specified using http: rather than https: because githack.com will redirect them to https:, but http: will
			work when using an HTTP proxy to serve local copies of the files without needing to run https: locally
		-->
		<link href="../../loader/api/api.css" rel="stylesheet" type="text/css" />
		<script src="../../loader/api/api.js"></script>
		<script>
			//	TODO	CORS
			document.domain = document.domain;
		</script>
	</head>
	<body>
		<div>__DESCRIPTION__</div>
		<div>
			<script type="application/x.jsapi#initialize">
				scope.module = $jsapi.loader.module("module.js", {
					api: {
						js: jsh.js,
						java: jsh.java
					}
				});
			</script>
			<h1>API</h1>
			<ul jsapi:reference="getApi('api.html').getElement('exports')">
			</ul>
			<script type="application/x.jsapi#tests"><![CDATA[
				var mockjsh = jsh.js.Object.set({}, jsh);
				mockjsh.tools = jsh.js.Object.set({}, mockjsh.tools);

				var MockFilePlugin = function(o) {
					if (!o) o = {};
					if (!o.initial) o.initial = {};

					var Directory = function(o) {
					};

					var File = function(o) {
					};

					var getNode = function(s) {
						var elements = s.substring(1).split("/");
						var current = o.initial;
						for (var i=0; i<elements.length; i++) {
							if (current) {
								current = current[elements[i]];
							}
						}
						if (typeof(current) == "undefined") {
							return {};
						}
						if (typeof(current) == "object") {
							return new Directory(current);
						} else {
							return new File(current);
						}
					}

					this.Pathname = function(s) {
						var rv = {};
						Object.defineProperty(rv, "directory", {
							get: function() {
								var node = getNode(s);
								if (node instanceof Directory) return node;
								return null;
							}
						});

						Object.defineProperty(rv, "file", {
							get: function() {
								var node = getNode(s);
								if (node instanceof File) return node;
								return null;
							}
						});
						return rv;
					};							
				};

				var MockShellPlugin = function(o) {
					this.os = {
						name: o.os.name
					};

					this.user = {};

					this.jsh = o.jsh;

					this.java = o.java;

					this.PATH = new function() {
						this.getCommand = function(s) {
							if (o.getPathCommand) return o.getPathCommand(s);
							return null;
						};
					};
				};

				verify(mockjsh).is.not(jsh);
				verify(mockjsh.js).is(jsh.js);
				verify(mockjsh.tools).is.not(jsh.tools);
				verify(mockjsh.tools.git,"mock jsh.tools.git").is(jsh.tools.git);

				var before = jsh.tools.git;

				var plugins = $jsapi.loader.plugin.mock({
					path: "../../rhino/tools/",
					jsh: jsh,
					evaluate: function(p) {
						return p.plugins;
					}
				});
				verify(plugins).is.type("object");

				mockjsh.file = new MockFilePlugin();
				mockjsh.shell = new MockShellPlugin({
					os: {
						name: "Linux"
					}
				});
				var plugin = $jsapi.loader.plugin.mock({
					plugins: plugins,
					jsh: mockjsh,
					evaluate: function(p) {
						return p.jsh.tools.git;
					}
				});
				verify(jsh.tools.git,"jsh.tools.git").is.not(before);
				verify(plugin).is.not(before);
				verify(plugin).evaluate.property("installation").is(void(0));

				mockjsh.file = new MockFilePlugin({
					initial: {
						Applications: {
							"Xcode.app": {}
						}
					}
				});
				var d = mockjsh.file.Pathname("/Applications/Xcode.app");
				verify(d).is.type("object");
				verify(d).evaluate.property("directory").is.type("object");
				mockjsh.shell = new MockShellPlugin({
					os: {
						name: "Mac OS X"
					},
					getPathCommand: function(s) {
						if (s == "git") return {};
					},
					jsh: {
						src: {
							getRelativePath: function(r) {
							}
						}
					},
					java: {
						jrunscript: {}
					}
				});
				plugin = $jsapi.loader.plugin.mock({
					plugins: plugins,
					jsh: mockjsh,
					evaluate: function(p) {
						return p.jsh.tools.git;
					}
				});
				verify(plugin).evaluate.property("installation").is.type("object");
			]]></script>
		</div>
	</body>
</html>