<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>jsh Servlet Plugin</title>
	<link rel="stylesheet" type="text/css" href="../../../loader/api/api.css"/>
	<script src="../../../loader/api/api.js"></script>
</head>
<body>
	<!--
		TODO	create a WAR
	-->
	<div>
		<h1>Exports</h1>
		<ul>
			<li class="object">
				<div class="name">spi</div>
				<span>__DESCRIPTION__</span>
				<div class="label">has properties:</div>
				<div class="type">
					<a class="type" name="types.servlet.implementation">servlet implementation</a>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="value">
							<div class="name">$loader</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
						<li class="function">
							<div class="name">load</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
						</li>
						<li class="value">
							<div class="name">resources</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</li>
					</ul>
				</div>
				<ul>
					<li class="function">
						<div class="name">argument</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">Loader</span>
									<span>The servlet container resource loader to use when implementing the servlet.</span>
								</li>
								<li class="object">
									<div class="name">__NAME__</div>
									<span>__DESCRIPTION__</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<div class="name">load</div>
											<span class="type">rhino/http/servlet servlet.load()</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">file</div>
											<span class="type">file</span>
											<span>__DESCRIPTION__</span>
										</li>
										<li class="value">
											<div class="name">resource</div>
											<span class="type">string</span>
											<span>__DESCRIPTION__</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">__TYPE__</span>
							<span>__DESCRIPTION__</span>
						</div>
					</li>
				</ul>
			</li>
			<li class="constructor">
				<div class="name">Resources</div>
				See <a href="plugin.jsh.resources.api.html">detailed documentation</a>.
			</li>
			<li class="constructor">
				<div class="name"><a id="$exports.Tomcat">jsh.httpd.Tomcat</a><!-- TODO rename to exports.Tomcat --></div>
				<span>
					(contingent; present only if Tomcat is present in the shell. See installation
					<a href="../../../jsh/tools/install/plugin.jsh.api.html#exports.jsh.tools.install">API</a>
					and <a href="../../../jsh/tools/install/cli.api.html">tools</a>.)
					Creates an embedded Tomcat server that can run script-based web applications. The server must have at least one
					application added via <code>map</code> before it will function.
				</span>
				<div class="arguments">
					<div class="label">Arguments</div>
					<ol>
						<li class="object">
							<span>
								(optional; default is an object with no properties)
								An object specifying the configuration of the embedded server.
							</span>
							<div class="label">has properties:</div>
							<ul>
								<li class="value">
									<div class="name">base</div>
									<span class="type"><a href="../../../rhino/file/api.html#types.directory">directory</a></span>
									<span>
										(optional; default creates and uses a temporary directory)
										The directory to use as Tomcat's <i>base</i> directory. Analogous to environment variable
										<code>CATALINA_BASE</code>.
									</span>
								</li>
								<li class="value">
									<div class="name">port</div>
									<span class="type">number</span>
									<span>
										(optional; default is to choose an open ephemeral port) The port number on which to run the
										HTTP server.
									</span>
								</li>
							</ul>
						</li>
					</ol>
				</div>
				<div class="instances">
					<div class="label">Instances</div>
					<span class="type"><a href="#types.Tomcat">Tomcat</a></span>
				</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">serve</div>
						<span>Starts a server that serves files from a particular directory.</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="object">
									<span>
										An object that provides properties to the <a href="#$exports.Tomcat">Tomcat constructor</a>,
										as well as:
									</span>
									<div class="label">has properties:</div>
									<ul>
										<li class="value">
											<span class="type"><a href="../../../rhino/file/api.html#types.directory">directory</a></span>
											<span>The directory whose files should be served.</span>
										</li>
									</ul>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type"><a href="#types.Tomcat">Tomcat</a></span>
							<span>The Tomcat object that was started.</span>
						</div>
						<script type="application/x.jsapi#tests">
							if (jsh.httpd.Tomcat) {
								var directory = jsh.shell.TMPDIR.createTemporary({ directory: true });
								directory.getRelativePath("a").write("a", { append: false });
								var tomcat = jsh.httpd.Tomcat.serve({
									directory: directory
								});
								var client = new jsh.http.Client();
								var response = client.request({
									url: "http://127.0.0.1:" + tomcat.port + "/" + "a"
								});
								var content = response.body.stream.character().asString();
								verify(response).status.code.is(200);
								verify(content).is("a");
								var response = client.request({
									url: "http://127.0.0.1:" + tomcat.port + "/" + "b"
								});
								verify(response).status.code.is(404);
								tomcat.stop();
							}
						</script>
					</li>
				</ul>
			</li>
			<li class="object">
				<div class="name">plugin</div>
				<span>__DESCRIPTION__</span>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">tools</div>
						<span>Loads the <a href="tools/plugin.jsh.api.html"><code>jsh.httpd.tools</code></a> plugin.</span>
					</li>
				</ul>
			</li>
			<li class="value">
				<div class="name">tools</div>
				<span class="type"><code>jsh.httpd.tools</code></span>
				<span>
					A module allowing for, among other things, servlet applications to be compiled into <code>.war</code> files.
					See <a href="tools/plugin.jsh.api.html">detailed documentation</a>.
				</span>
			</li>
		</ul>
	</div>
</body>
</html>
