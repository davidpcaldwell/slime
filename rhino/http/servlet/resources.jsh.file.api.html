<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.


The Original Code is the SLIME servlet interface.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2014 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>__TITLE__</title>
	<!--	TODO	change these to use local copies of these files at the appropriate location	-->
	<link href="../../../loader/api/api.css" rel="stylesheet" type="text/css" />
	<script src="../../../loader/api/api.js"></script>
</head>
<body>
	<div>__DESCRIPTION__</div>
	<div>
		<h1>Context</h1>
		<ul>
		</ul>
		<script type="application/x.jsapi#context">
			(function() {
				return new function() {
					this.getMimeType = function(file) {
						return "text/plain";
					}
				}
			})()
		</script>
	</div>
	<div>
		<h1>Exports</h1>
		<ul>
		</ul>
		<script type="application/x.jsapi#initialize">
			var code = {};
			var shell = {
				httpd: code,
				loader: jsh.loader,
				io: jsh.io
			}
			module.addJshPluginTo(shell);
			scope.code = code;
		</script>
		<script type="application/x.jsapi#tests">
			var one = code.Resources.script(
				$module.getResourcePathname("test/resource/1.old.js").file
			);
			verify(one,"one").isNotEqualTo(3);
			verify(one).loader().list({ path: "WEB-INF/generic/" }).length().is(1);
			verify(one).loader().list({ path: "WEB-INF/generic/" })[0]().is("inonit/");
			verify(one).loader().list({ path: "WEB-INF/generic/inonit/script/servlet/" }).length().is(2);
			verify(one).loader().list({ path: "WEB-INF/generic/inonit/script/servlet/" })[0]().is("Nashorn.java");
			verify(one).loader().list({ path: "WEB-INF/generic/inonit/script/servlet/" })[1]().is("Servlet.java");
			verify(one).loader().list({ path: "WEB-INF/" }).length().is(3);
			verify(one).loader().list({ path: "WEB-INF/" })[0]().is("generic/");
			verify(one).loader().list({ path: "WEB-INF/" })[1]().is("mozilla/");
			verify(one).loader().list({ path: "WEB-INF/" })[2]().is("test/");
			verify(one).loader().file("WEB-INF/test/1.file.js").isNotEqualTo(null);
			verify(one).loader().resource("WEB-INF/test/1.txt").read(String).is("1");
		</script>
		<script type="application/x.jsapi#tests">
			verify(code,"code").Resources().isNotEqualTo(3);
			var one = new code.Resources();
			var $mapping = $module.getResourcePathname(".").directory;
//			one.add({ prefix: "WEB-INF/generic/", loader: new jsh.file.Loader({ directory: $mapping.getRelativePath("../../java").directory })});
//			one.add({ prefix: "WEB-INF/mozilla/", loader: new jsh.file.Loader({ directory: $mapping.getRelativePath("../../rhino").directory })});
//			one.add({ prefix: "WEB-INF/test/", loader: new jsh.file.Loader({ directory: $mapping.parent })});
			one.add({ prefix: "WEB-INF/generic/", directory: $mapping.getSubdirectory("java") });
			one.add({ prefix: "WEB-INF/mozilla/", directory: $mapping.getSubdirectory("rhino") });
			one.add({ prefix: "WEB-INF/test/", directory: $mapping.getSubdirectory("test") });
			verify(one,"one").isNotEqualTo(3);
			verify(one).loader().list({ path: "WEB-INF/generic/" }).length().is(1);
			verify(one).loader().list({ path: "WEB-INF/generic/" })[0]().path().is("inonit");
			verify(one).loader().list({ path: "WEB-INF/generic/" })[0]().loader().isNotEqualTo(null);
			var child = new one.loader.Child("WEB-INF/generic/");
			verify(child).isNotEqualTo(null);
			verify(child).list({ path: "" }).isNotEqualTo(null);
			var generic = new one.loader.Child("WEB-INF/generic/");
			verify(generic,"generic").list({ path: "" }).isNotEqualTo(null);
			verify(generic,"generic").list({ path: "" }).length().is(1);
//			verify(one).loader().list({ path: "WEB-INF/generic/inonit/script/servlet/" }).length().is(2);
//			verify(one).loader().list({ path: "WEB-INF/generic/inonit/script/servlet/" })[0]().is("Nashorn.java");
//			verify(one).loader().list({ path: "WEB-INF/generic/inonit/script/servlet/" })[1]().is("Servlet.java");
//			verify(one).loader().list({ path: "WEB-INF/" }).length().is(3);
//			verify(one).loader().list({ path: "WEB-INF/" })[0]().is("generic/");
//			verify(one).loader().list({ path: "WEB-INF/" })[1]().is("mozilla/");
//			verify(one).loader().list({ path: "WEB-INF/" })[2]().is("test/");
//			verify(one).loader().file("WEB-INF/test/1.file.js").isNotEqualTo(null);
//			verify(one).loader().resource("WEB-INF/test/1.txt").read(String).is("1");
		</script>
	</div>
</body>
</html>