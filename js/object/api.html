<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.

END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
<head>
	<title>JavaScript language constructs</title>
	<link rel="stylesheet" type="text/css" href="../../loader/api/api.css" />
	<script type="text/javascript" src="../../loader/api/api.js"></script>
</head>
<body>
	<div>
		<h1>Context</h1>
		<ul>
			<li class="value">
				<div class="name">globals</div>
				<code>(boolean)</code> Whether to modify the global scope by supplying implementations of missing methods. If
				<code>true</code>, this module, in addition to providing the exports below, supplies implementations of the
				following JavaScript constructs if they are not supplied by the environment. These constructs do not currently
				have any automated tests implemented and thus should be treated as suspect.
				<!--	TODO	make the above statement untrue: use some sort of decent tests.	-->
				<div>
					<ul>
						<li>Object
							<ul>
								<li>ECMA 262v5: Object.keys</li>
							</ul>
						</li>
						<li>Array
							<ul>
								<li>JS 1.6: Array.prototype.indexOf</li>
								<li>JS 1.6: Array.prototype.filter</li>
								<li>JS 1.6: Array.prototype.forEach</li>
								<li>JS 1.6: Array.prototype.map</li>
							</ul>
						</li>
					</ul>
				</div>
			</li>
		</ul>
		<script type="application/x.jsapi#context">
			new function() {
				this.globals = false;
			}
		</script>
	</div>
	<div>
		<h1>Exports</h1>
		<script type="application/x.jsapi#initialize">
			scope.module = $jsapi.loader.module("module.js");
		</script>
		<script type="application/x.jsapi#initialize">
			scope.Functions = function() {
				var calculator = function() {
					arguments.callee.invocations++;
					return 2*2;
				}
				calculator.invocations = 0;

				var undefinedCalculator = function() {
					arguments.callee.invocations++;
					return;
				}
				undefinedCalculator.invocations = 0;

				this.calculator = calculator;
				this.undefinedCalculator = undefinedCalculator;
			}
		</script>
		<div class="type">
			<a class="type" name="types.task">task</a>
			<span>
				A JavaScript function representing an operation that can be scheduled. Although it is both a function, and
				represents a function-like operation (it can return a value), it does not receive arguments in the ordinary
				sense; it can receive a single argument called a <i>tell</i> to which its results will be sent, or it can
				return them directly to the caller.
			</span>
			<div class="type">
				<a class="type" name="types.task.tell">tell</a>
				<span>An object to notify with the results of an <a href="#types.task">task</a>.</span>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">returned</div>
						<span>A function that will be invoked when the task completes.</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span>The value returned by the <a href="#types.task">task</a>.</span>
								</li>
							</ol>
						</div>
					</li>
					<li class="function">
						<div class="name">threw</div>
						<span>A function that will be invoked if the task does not complete successfully.</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span>The error (or value) thrown by the <a href="#types.task">task</a>.</span>
								</li>
							</ol>
						</div>
					</li>
					<li class="object">
						<div class="name">target</div>
						<span>
							(optional)
							An object that will be <code>this</code> when the <code>returned</code> or <code>threw</code> functions
							are invoked upon completion of the task.
						</span>
					</li>
				</ul>
			</div>
			<div class="arguments">
				<div class="label">Arguments</div>
				<ol>
					<li class="value">
						<span class="type"><a href="#types.task.tell">tell</a></span>
						<span>
							(optional)
							A recipient for the result of this task.
						</span>
					</li>
				</ol>
			</div>
			<div class="returns">
				<div class="label">Returns</div>
				<span>
					If no <a href="#types.task.tell">tell</a> was supplied, the value returned by the task.
				</span>
			</div>
		</div>
		<ul>
			<li class="object" jsapi:id="Filter">
				<script type="application/x.jsapi#initialize"><![CDATA[
					//	TODO	load this from globals.js somehow?

					scope.Array_filter = function(f) {
						var rv = [];
						for (var i=0; i<this.length; i++) {
							if (f(this[i])) {
								rv.push(this[i]);
							}
						}
						return rv;
					}
				]]></script>
				<div class="name">Filter</div>
				<div>
					A <i>Filter</i> is a function that implements a particular interface: it takes a single argument, and returns a
					<code>boolean</code>.
				</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="function" jsapi:id="property">
						<div class="name">property</div>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li>
									<span class="type">string</span>
									<span>A property name.</span>
								</li>
								<li class="value">
									<span class="type">Filter</span>
									<span>A Filter to apply to the given property.</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">Filter</span>
							A Filter that returns <code>true</code> if the value of its property for the given property
							name is accepted by the given Filter, and <code>false</code> otherwise.
						</div>
						<script type="application/x.jsapi#tests" jsapi:id="1"><![CDATA[
							var isUpperCase = function(value) {
								return value.toUpperCase() == value;
							}

							var filter = module.Filter.property("a",isUpperCase);

							var a = { a: "A" };
							var b = { a: "a" };

							test(Array_filter.call([a,b], filter).length == 1);
							test(Array_filter.call([a,b], filter)[0] == a);
						]]></script>
					</li>
					<li class="function">
						<div class="name">equals</div>
						<span>
						</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li>A target value.</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">Filter</span>
							<span>
								A Filter that returns <code>true</code> if its argument equals the given target value, and
								<code>false</code> otherwise.
							</span>
						</div>
					</li>
					<li class="function">
						<div class="name">not</div>
						<!--	TODO	Add tests for Filter.not	-->
						<span>An object that returns a <code>Filter</code> that is the inverse of a given <code>Filter</code>.</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">Filter</span>
									<span>A filter to reverse.</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">Filter</span>
							<span>
								A <code>Filter</code> that returns <code>true</code> when the given <code>Filter</code> returns
								<code>false</code>, and vice-versa.
							</span>
						</div>
					</li>
				</ul>
				<script type="application/x.jsapi#tests">
					var f = module.Filter.property("a", module.Filter.equals(3));
					var array = [{ a: 3 }, {}, { a: 4 }];
					var matches = Array_filter.call(array, f);
					test(matches.length == 1);
					test(matches[0] == array[0]);
				</script>
			</li>
			<!--	TODO	convert Map/Order to types	-->
			<li class="object" jsapi:id="Map">
				<div class="name">Map</div>
				<span>
					A <i>Map</i> is a function that implements a particular interface: it takes a single argument, and returns
					a value.
				</span>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">property</div>
						<span>__DESCRIPTION__</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">string</span>
									<span>A property name.</span>
								</li>
								<li class="value">
									<span class="type">Map</span>
									<span>(optional) A Map</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">Map</span>
							<span>
								A Map which returns the named property of an object. If the optional Map argument is not provided,
								the Map returns the named property of its argument. Otherwise, it first applies the Map argument to
								its argument, and then returns the named property of the result.
							</span>
						</div>
						<script type="application/x.jsapi#tests" jsapi:id="Map">
							var one = module.Map.property("c");
							var two = module.Map.property("a", module.Map.property("b"));
							var x = {
								b: { a: 3 },
								c: 4
							};
							test(one(x) == 4);
							test(two(x) == 3);
							test(one({}) != 5);
						</script>
					</li>
				</ul>
				<!--	TODO	decide whether Map.Categorizer is experimental; find a use of it: my guess is prop8	-->
			</li>
			<li class="object" jsapi:id="Order">
				<div class="name">Order</div>
				<span>
					An <i>Order</i> is a function that implements a specific interface, intended for sorting: it takes two
					arguments and returns a value less than zero if the first argument belongs before the second argument, and a
					value greater than zero if the second argument belongs before the first argument. This is commensurate with the
					<code>Array.prototype.sort</code> method.
				</span>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">property</div>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">string</span>
									<span>A property name.</span>
								</li>
								<li class="value">
									<span class="type">Order</span>
									<span>An Order to use to compare values of the given named property.</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">Order</span>
							<span>
								An Order that uses the given Order to compare the value of the named property for each of its
								arguments and returns the result of that comparison.
							</span>
						</div>
					</li>
					<li class="function">
						<div class="name">map</div>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">Map</span>
									<span>A Map that transforms the arguments to this Order before they are compared.</span>
								</li>
								<li class="value">
									<span class="type">Order</span>
									<span>An Order to use to compare values produced by the given Map.</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span class="type">Order</span>
							<span>
								An Order that uses the given Order to compare the value the given Map produces for each of its
								arguments and returns the result of that comparison.
							</span>
						</div>
					</li>
				</ul>
				<script type="application/x.jsapi#tests" jsapi:id="Order">
					var numerical = function(a,b) { return b - a; };
					var ascending = function(a,b) { return a - b; };
					var array = [ { s: "a", v: 2 }, { s: "b", v: 1 }, { s: "c", v: 3 } ];
					var propertyOrder = module.Order.property("v", numerical);
					var mapOrder = module.Order.map(module.Map.property("v"), ascending);
					array.sort( propertyOrder );
					test(array[0].s == "c");
					test(array[1].s == "a");
					test(array[2].s == "b");
					array.sort( mapOrder );
					test(array[0].s == "b");
					test(array[1].s == "a");
					test(array[2].s == "c");
				</script>
			</li>
			<li class="object" jsapi:id="Array">
				<div class="name">Array</div>
				<div class="label">has properties:</div>
				<ul>
					<li class="function">
						<div class="name">choose</div>
						<span>
							Converts an array into a single element. First applies the given Filter, if one is given: the Filter
							should be a filter that only accepts zero or one element of the array.
						</span>
						<div class="arguments">
							<div class="label">Arguments</div>
							<ol>
								<li class="value">
									<span class="type">Array</span>
									<span>An array.</span>
								</li>
								<li class="value">
									<span class="type">Filter</span>
									<span>(optional) A Filter that is used to preprocess the array.</span>
								</li>
							</ol>
						</div>
						<div class="returns">
							<div class="label">Returns</div>
							<span>
								The single element of the array (after applying the given Filter, if applicable), or
								<code>null</code> if the array has zero elements. An error is thrown if more than one element
								matches.
							</span>
						</div>
						<script type="application/x.jsapi#tests" jsapi:id="Array.choose">
							test( module.Array.choose([ 3 ]) == 3 );
							test( module.Array.choose([]) === null );
							test( module.Array.choose([ 1, 2, 3 ], function(a) { return a == 3; } ) == 3 );
						</script>
					</li>
				</ul>
				<!--	TODO	decide whether Array.categorize is experimental	-->
			</li>
		</ul>
	</div>
</body>
</html>
