<!--
LICENSE
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not
distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.


The Original Code is the SLIME loader infrastructure.

The Initial Developer of the Original Code is David P. Caldwell <david@davidpcaldwell.com>.
Portions created by the Initial Developer are Copyright (C) 2015 the Initial Developer. All Rights Reserved.

Contributor(s):
END LICENSE
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:jsapi="http://www.inonit.com/jsapi">
	<head>
		<title>$api</title>
		<link href="api/api.css" rel="stylesheet" type="text/css" />
		<script src="api/api.js"></script>
	</head>
	<body>
		<h1>$api</h1>
		<div jsapi:id="top">
			<script type="application/x.jsapi#initialize">
				var $slime = {
					getRuntimeScript: function(path) {
						return {
							name: path,
							js: $jsapi.loader.string(path)
						}
					}
				};
				scope.api = $jsapi.loader.eval("$api.js", { $platform: $platform, $slime: $slime });
				scope.api.loadedByJsapi = true;
			</script>
			<div jsapi:id="summary">
				The <code>$api</code> object is provided to all code loaded by the platform loader. It provides basic JavaScript
				language functionality.
			</div>
			<div>
				<h2>API flagging: deprecation, experimental APIs</h2>
				<div>
					Various <code>$api</code> methods can "flag" APIs for callers, causing a configurable callback to be executed
					when they are invoked, to warn the users that the APIs are deprecated or experimental. See
					<a href="$api-flag.api.html">detailed documentation.</a>
				</div>
			</div>
			<div>
				<h2><code><a href="$api-Function.api.html">$api.Function</a></code></h2>
				<div>
					Provides functional programming constructs.
				</div>
			</div>
			<h2>Other APIs</h2>
			<ul>
				<li class="object" jsapi:id="Constructor">
					(undocumented function with test coverage)
					<!--
					<div class="name">__NAME__</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
					</ul>
					-->
					<script type="application/x.jsapi#tests">
						verify(api.Constructor).is.not.equalTo(void(0));
						var A = function() {
							this.a = 1;
						};
						var B = function() {
							this.b = 2;
						};
						var C = function() {
							this.c = 3;
						};

						var AB = api.Constructor.decorated(A,B);
						var ABC = api.Constructor.decorated(AB,C);

						var abc = new ABC();
						verify(abc.a).is(1);
						verify(abc.b).is(2);
						verify(abc.c).is(3);

						var BC = api.Constructor.decorated(B,C);
						var ABC2 = api.Constructor.decorated(A,BC);
						var abc2 = new ABC2();
						verify(abc2.a).is(1);
						verify(abc2.b).is(2);
						verify(abc2.c).is(3);
					</script>
					<script type="application/x.jsapi#tests">
						verify(api).evaluate.property("Constructor").is.not(void(0));
						verify(api).Constructor.evaluate.property("invoke").is.not(void(0));

						var A = function(a,b) {
							this.a = a;
							this.b = b;
						};

						var a1 = api.Constructor.invoke({
							constructor: A,
							arguments: [1,2]
						});
						verify(a1).a.is(1);
						verify(a1).b.is(2);

						var a2 = api.Constructor.invoke({
							constructor: A,
							arguments: [1]
						});
						verify(a2).a.is(1);
						verify(a2).b.is(void(0));

						var a3 = api.Constructor.invoke({
							constructor: A,
							arguments: []
						});
						verify(a3).a.is(void(0));
						verify(a3).b.is(void(0));

						(function omittedArguments() {
							var a = api.Constructor.invoke({
								constructor: A
							});
							verify(a).a.is(void(0));
							verify(a).b.is(void(0));
						})();

						api.Constructor.global();
						(function() {
							var a = A.construct(1,2);
							verify(a).a.is(1);
							verify(a).b.is(2);
						})();
					</script>
				</li>
				<li class="function">
					<div class="name">Key</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">by</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
							<script type="application/x.jsapi#tests">
								var array = [
									{ a: 1, b: 2 },
									{ a: 1, b: 3 },
									{ a: 2, b: 4 },
									{ a: 1, b: 5 }
								];

								var lists = api.Key.by({
									key: function(value) {
										return value.a;
									},
									array: array
								});
								verify(lists)[1].length.is(3);
								verify(lists)[2].length.is(1);

								var counts = api.Key.by({
									key: function(value) {
										return value.a;
									},
									count: true,
									array: array
								});
								verify(counts)[1].is(3);
								verify(counts)[2].is(1);
								verify(counts).evaluate.property(3).is(void(0));

								var countKeys = api.Key.by({
									keys: [1,2,3],
									key: function(value) {
										return value.a;
									},
									count: true,
									array: array
								});
								verify(countKeys)[1].is(3);
								verify(countKeys)[2].is(1);
								verify(countKeys)[3].is(0);
							</script>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">Iterable</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">groupBy</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="object">
										<span>__DESCRIPTION__</span>
										<div class="label">has properties:</div>
										<ul>
											<li class="function">
												<div class="name">group</div>
												<span>__DESCRIPTION__</span>
												<div class="arguments">
													<div class="label">Arguments</div>
													<ol>
														<li class="value">
															<span class="type">__TYPE__</span>
															<span>An element to group.</span>
														</li>
													</ol>
												</div>
												<div class="returns">
													<div class="label">Returns</div>
													<span class="type">__TYPE__</span>
													<span>A group.</span>
												</div>
											</li>
											<li class="value">
												<div class="name">groups</div>
												<span class="type">__TYPE__</span>
												<span>
													A set of groups to use in the output. Note that the <code>group</code> function
													still is responsible for grouping, so if it returns groups not in this set,
													they will be included in the output. This value is for the purpose of
													<em>guaranteeing</em> certain elements will be returned (even with empty lists
													or zero counts).
												</span>
											</li>
											<li class="object">
												<div class="name">codec</div>
												<span>
													(optional)
												</span>
												<div class="label">has properties:</div>
												<ul>
													<li class="function">
														<div class="name">encode</div>
														<span>__DESCRIPTION__</span>
														<div class="arguments">
															<div class="label">Arguments</div>
															<ol>
															</ol>
														</div>
														<div class="returns">
															<div class="label">Returns</div>
															<span class="type">string</span>
															<span>A distinct string identifying the given group.</span>
														</div>
													</li>
													<li class="function">
														<div class="name">decode</div>
														<span>__DESCRIPTION__</span>
														<div class="arguments">
															<div class="label">Arguments</div>
															<ol>
															</ol>
														</div>
														<div class="returns">
															<div class="label">Returns</div>
															<span class="type">__TYPE__</span>
															<span>__DESCRIPTION__</span>
														</div>
													</li>
												</ul>
											</li>
											<li class="value">
												<div class="name">array</div>
												<span class="type">Array</span>
												<span>A set of elements to group.</span>
											</li>
											<li class="value">
												<div class="name">count</div>
												<span class="type">__TYPE__</span>
												<span>__DESCRIPTION__</span>
											</li>
										</ul>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
								</ul>
							</div>
						</li>
						<li class="function">
							<div class="name">match</div>
							<span>
								A function that operates on two lists, called <code>left</code> and <code>right</code>, pertaining
								to a common underlying set. Callers specify a <code>matches</code> function that can determine
								which elements on each side <dfn>match</dfn>, or pertain to the same logical element in the set.
								The method will identify which elements from each list match, and which from each list remain
								unmatched after searching for matches. The results will be returned; optionally, a callback can
								be invoked for each element based on the result for that element.
							</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="object">
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">left</div>
												<span class="type">__TYPE__</span>
												<span>__DESCRIPTION__</span>
											</li>
											<li class="value">
												<div class="name">right</div>
												<span class="type">__TYPE__</span>
												<span>__DESCRIPTION__</span>
											</li>
											<li class="function">
												<div class="name">matches</div>
												<span>__DESCRIPTION__</span>
												<div class="arguments">
													<div class="label">Arguments</div>
													<ol>
														<li class="value">
															<span class="type">__TYPE__</span>
															<span>An element from <code>left</code>.</span>
														</li>
														<li class="value">
															<span class="type">__TYPE__</span>
															<span>An element from <code>right</code>.</span>
														</li>
													</ol>
												</div>
												<div class="returns">
													<div class="label">Returns</div>
													<span class="type">boolean</span>
													<span>
														<code>true</code> if the two elements <dfn>match</dfn>, that is,
														pertain to the same element in the underlying set.
													</span>
												</div>
											</li>
											<li class="object">
												<div class="name">unmatched</div>
												<span>__DESCRIPTION__</span>
												<div class="label">has properties:</div>
												<ul>
													<li class="function">
														<div class="name">left</div>
														<span>
															A callback invoked for each item from <code>left</code> that
															does not match.
														</span>
														<div class="arguments">
															<div class="label">Arguments</div>
															<ol>
																<li class="value">
																	<span class="type">__TYPE__</span>
																	<span>The element from <code>left</code>.</span>
																</li>
															</ol>
														</div>
													</li>
													<li class="function">
														<div class="name">right</div>
														<span>
															A callback invoked for each item from <code>right</code> that
															does not match.
														</span>
														<div class="arguments">
															<div class="label">Arguments</div>
															<ol>
																<li class="value">
																	<span class="type">__TYPE__</span>
																	<span>The element from <code>right</code>.</span>
																</li>
															</ol>
														</div>
													</li>
												</ul>
											</li>
											<li class="function">
												<div class="name">matched</div>
												<span>A callback invoked for each pair of items that matches.</span>
												<div class="arguments">
													<div class="label">Arguments</div>
													<ol>
														<li class="value">
															<span class="type">__TYPE__</span>
															<span>An element from <code>left</code>.</span>
														</li>
														<li class="value">
															<span class="type">__TYPE__</span>
															<span>An element from <code>right</code>.</span>
														</li>
													</ol>
												</div>
											</li>
										</ul>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
								</ul>
							</div>
							<script type="application/x.jsapi#tests">
								var left = ["a", "b"];
								var right = ["B", "C"];
								var matches = function(a,b) {
									return a.toLowerCase() == b.toLowerCase();
								};

								var recordingFunction = function() {
									var rv = function() {
										arguments.callee.received.push(Array.prototype.slice.call(arguments));
									};
									rv.received = [];
									return rv;
								};

								var onLeft = recordingFunction();
								var onRight = recordingFunction();
								var onMatch = recordingFunction();

								var result = api.Iterable.match({
									left: left,
									right: right,
									matches: matches,
									unmatched: {
										left: onLeft,
										right: onRight
									},
									matched: onMatch
								});
								verify(result).unmatched.left.length.is(1);
								verify(result).unmatched.right.length.is(1);
								verify(result).matched.length.is(1);
								verify(onLeft.received).length.is(1);
								verify(onLeft.received)[0].length.is(1);
								verify(onRight.received).length.is(1);
								verify(onRight.received)[0].length.is(1);
								verify(onMatch.received).length.is(1);
								verify(onMatch.received)[0].length.is(1);
								verify(onMatch.received)[0][0].left.is.type("string");
								verify(onMatch.received)[0][0].right.is.type("string");
							</script>
						</li>
					</ul>
				</li>
				<li class="function" jsapi:id="Properties">
					<div class="name">Properties</div>
					<span>__DESCRIPTION__</span>
					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
					<script type="application/x.jsapi#tests">
						var empty = api.Properties();
						verify(empty).length.is(0);

						verify(api).evaluate(function(api) {
							return api.Properties(null);
						}).threw.type(TypeError);

						verify(api).Properties({ array: [ { name: "foo", value: "bar" } ] }).length.is(1);

						verify(api).Properties({ object: { foo: "bar" } }).length.is(1);
						verify(api).Properties({ object: { foo: "bar" } })[0].name.is("foo");
						verify(api).Properties({ object: { foo: "bar" } })[0].value.is("bar");
					</script>
				</li>
				<li class="function">
					<div class="name">Object</div>
					<span>__DESCRIPTION__</span>
					<div class="type">
						<a class="type" name="types.property">property</a>
						<span>__DESCRIPTION__</span>
						<div class="label">has properties:</div>
						<ul>
							<li class="value">
								<div class="name">name</div>
								<span class="type">string</span>
								<span>__DESCRIPTION__</span>
							</li>
							<li class="value">
								<div class="name">value</div>
								<span class="type">(any)</span>
								<span>__DESCRIPTION__</span>
							</li>
						</ul>
					</div>

					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">properties</div>
										<span class="type">Array of <a href="#types.property">property</a></span>
										<span>__DESCRIPTION__</span>
									</li>
								</ul>
							</li>
						</ol>
					</div>
					<div class="returns">
						<div class="label">Returns</div>
						<span class="type">__TYPE__</span>
						<span>__DESCRIPTION__</span>
					</div>
					<script type="application/x.jsapi#tests">
						var properties = [{ name: "foo", value: "bar" }, { name: "a", value: "b" }];
						var object = api.Object({ properties: properties });
						verify(object).foo.is("bar");
						verify(object).a.is("b");
					</script>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">property</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
							<script type="application/x.jsapi#tests">
								verify(api.Object).is.not.equalTo(void(0));
								verify(api.Object.property).is.not.equalTo(void(0));
								var test = {
									name: "value"
								};
								verify(api.Object.property.call(test,"name","length")).is("value".length);
							</script>
						</li>
						<li class="function">
							<div class="name">properties</div>
							<span>Returns the list of properties for an object.</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="value">
										<span class="type">object</span>
										<span>__DESCRIPTION__</span>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">Array of <a href="#types.property">property</a></span>
								<span>__DESCRIPTION__</span>
							</div>
							<script type="application/x.jsapi#tests">
								var o = { a: 1, b: 2 };
								var properties = api.Object.properties(o);
								verify(properties).length.is(2);

								var rebuilt = properties.object();
								verify(rebuilt).a.is(1);
								verify(rebuilt).b.is(2);

								var filtered = api.Object.properties(o).filter(function(property) {
									return property.name == "a";
								}).object();
								verify(filtered).a.is(1);
								verify(filtered).evaluate.property("b").is(void(0));
							</script>
						</li>
						<li class="function">
							<div class="name">compose</div>
							<span>
								Takes a list of objects and composes them into a new object. Properties are copied from each
								source object in succession, with values from later objects replacing those from earlier objects.
							</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
							<script type="application/x.jsapi#tests">
								(function() {
									var composed = api.Object.compose({ a: 1, b: 1 }, { a: 2 });
									verify(composed).a.is(2);
									verify(composed).b.is(1);
								})();
							</script>
						</li>
						<li class="function">
							<div class="name">optional</div>
							<span>Provides an optional chaining API that seeks to be maximally compatible with the current
								<a href="https://github.com/tc39/proposal-optional-chaining">proposal</a>.
							</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								The first argument is an object to dereference. Further arguments are a series of properties to
								access. If any property but the last is missing, <code>undefined</code> will be returned. Otherwise,
								the value of the last property will be returned.
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">(any)</span>
								<span>
									The value of the property chain for the given object, or <code>undefined</code> if the
									chain is incomplete.
								</span>
							</div>
							<script type="application/x.jsapi#tests">
								var a = {
									b: {
										c: null,
										n: 2
									}
								};
								verify($api.Object.optional(a, "b", "c")).is(null);
								verify($api.Object.optional(a, "b", "n")).is(2);
								verify($api.Object.optional(a, "c", "x")).is(void(0));

								verify($api.Object.optional(null, "x")).is(void(0));
							</script>
						</li>
					</ul>
				</li>
				<li class="object">
					<div class="name">Value</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="function">
							<div class="name">require</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
							<script type="application/x.jsapi#tests"><![CDATA[
								verify(api.Value).is.not.equalTo(void(0));
								var one = {
									name: "value1",
									nested: {
										value: "nested1",
										method: function() {
											return "method";
										}
									}
								};
								var value = api.Value(one,"one");
								var disableBreakOnExceptions = ($jsapi.debug && $jsapi.debug.disableBreakOnExceptions) ? $jsapi.debug.disableBreakOnExceptions : function(f) { return f; };
								disableBreakOnExceptions(function() {
									verify(value).evaluate(function() { return this.require(); }).threw.nothing();
									verify(value).property("foo").evaluate(function() { return this.require() }).threw.type(TypeError);
									verify(value).property("foo").evaluate(function() { return this.require(); }).threw.message.is("one.foo is required");
									if (!$jsapi.java || !$jsapi.java.loader || !$jsapi.java.loader.test || !$jsapi.java.loader.test.HAS_NASHORN_ERROR_HACK) {
										verify(value).evaluate(function() { return this.property("foo","bar"); }).threw.type(TypeError);
									}
									verify(value).property("name").evaluate(function() { return this.require() }).threw.nothing();
									verify(value).property("name","length").evaluate(function() { return this.require() }).threw.nothing();
									verify(value).property("nested","value").evaluate(function() { return this.require() }).threw.nothing();
									verify(value).property("nested","value1").evaluate(function() { return this.require() }).threw.type(TypeError);
									verify(one).nested.method().is("method");
								})();
							]]></script>
						</li>
					</ul>
				</li>
				<li jsapi:id="Events" class="function">
					<div class="name">Events</div>
					<span>Creates an event emitter that can be used to fire events to a set of listeners. Event emitters can be arranged in a hierarchy.</span>
					<div class="type">
						<a class="type" name="types.Event">Event</a>
						<span>An event fired by an event source.</span>
						<div class="label">has properties:</div>
						<ul>
							<li class="value">
								<div class="name">type</div>
								<span class="type">string</span>
								<span>An event <dfn>type</dfn>. Event sources may define arbitrary types.</span>
								<script type="application/x.jsapi#tests">
									var emitter = api.Events();

									var event;

									emitter.listeners.add("aType", function(e) {
										event = e;
									});

									emitter.fire("aType");

									verify(event).type.is("aType");
								</script>
							</li>
							<li class="value">
								<div class="name">source</div>
								<span class="type">object</span>
								<span>
									An event <dfn>source</dfn>. This object may be the <code>Events</code> itself, or an arbitrary object specified as the logical
									event source.
								</span>
								<script type="application/x.jsapi#tests">
									var emitter = api.Events();

									var event;

									emitter.listeners.add("aType", function(e) {
										event = e;
									});

									emitter.fire("aType");

									verify(event).source.is(emitter);
								</script>
								<script type="application/x.jsapi#tests">
									var parent = api.Events();
									var child = api.Events({ parent: parent });

									var last;

									parent.listeners.add("aType", function(e) {
										last = e;
									});

									parent.fire("aType");
									verify(last).source.is(parent);
									child.fire("aType");
									verify(last).source.is(child);
								</script>
							</li>
							<li class="value">
								<div class="name">path</div>
								<span class="type">Array of emitter</span>
								<span>
									When accessed in an event handler, will be set to the current <dfn>path</dfn> in the emitter hierarchy from which
									this event was fired.
								</span>
								<script type="application/x.jsapi#tests">
									var parent = api.Events();
									var child = api.Events({ parent: parent });

									var received = {
									};

									var receive = function(name) {
										return function(e) {
											received[name] = { source: e.source, path: e.path.slice() };
										};
									};

									parent.listeners.add("aType", receive("parent"));
									child.listeners.add("aType", receive("child"));

									child.fire("aType");
			
									verify(received).parent.path.length.is(1);
									verify(received).parent.path[0].is(child);					
									verify(received).child.path.length.is(0);
								</script>
							</li>
							<li class="value">
								<div class="name">timestamp</div>
								<span class="type">number</span>
								<span>
									The time at which the event was fired, in the same format as used by the <code>Date</code> constructor.
								</span>
								<script type="application/x.jsapi#tests">
									//	TODO	mock Date to allow testing value below?

									var emitter = api.Events();

									var event;

									emitter.listeners.add("aType", function(e) {
										event = e;
									});

									emitter.fire("aType");

									verify(event).timestamp.is.type("number");
								</script>
							</li>
							<li class="value">
								<div class="name">detail</div>
								<span class="type">(any)</span>
								<span>An arbitrary value attached to the event when it is fired containing additional information.</span>
								<script type="application/x.jsapi#tests">
									var emitter = api.Events();

									var events = [];;

									emitter.listeners.add("aType", function(e) {
										events.push(e);
									});

									emitter.fire("aType");
									emitter.fire("aType", void(0));
									emitter.fire("aType", null);
									emitter.fire("aType", true);
									emitter.fire("aType", 2);
									emitter.fire("aType", "aString");
									emitter.fire("aType", { property: "value" });

									verify(events)[0].detail.is(void(0));
									verify(events)[1].detail.is(void(0));
									verify(events)[2].detail.is(null);
									verify(events)[3].detail.is(true);
									verify(events)[4].detail.is(2);
									verify(events)[5].detail.is("aString");
									verify(events)[6].detail.property.is("value");
								</script>
							</li>
						</ul>
					</div>
					<div class="type">
						<a class="type" name="types.emitter">emitter</a>
						<span>__DESCRIPTION__</span>
						<div class="label">has properties:</div>
						<ul>
							<li class="object">
								<div class="name">listeners</div>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="function">
										<div class="name">add</div>
										<span>Adds an event listener that will be notified about a particular <dfn>type</dfn> of events.</span>
										<div class="arguments">
											<div class="label">Arguments</div>
											<ol>
												<li class="value">
													<span class="type">string</span>
													<span>An event <dfn>type</dfn>.</span>
												</li>
												<li class="function">
													<span>
														A listener function that will be invoked when the event occurs, with <code>this</code> set to the emitter's event source.
													</span>
													<div class="arguments">
														<div class="label">Arguments</div>
														<ol>
															<li class="value">
																<span class="type">Event</span>
																<span>An event of the specified type.</span>
															</li>
														</ol>
													</div>
												</li>
											</ol>
										</div>
										<script type="application/x.jsapi#tests">
											var emitter = api.Events();
	
											var called = false;
	
											emitter.listeners.add("aType", function() {
												verify(this).is(emitter);
												called = true;
											});
	
											emitter.fire("aType");
											verify(called).is(true);
										</script>
										<script type="application/x.jsapi#tests">
											var source = {};
											var emitter = api.Events({ source: source });
	
											var called = false;
	
											emitter.listeners.add("aType", function() {
												verify(this).is(source);
												called = true;
											});
	
											emitter.fire("aType");
											verify(called).is(true);
										</script>
										<script type="application/x.jsapi#tests">
											var parent = {};
											var child = {};
											var emitters = {};
											emitters.parent = api.Events({ source: parent });
											emitters.child = api.Events({ source: child, parent: emitters.parent });
	
											var called = {
												parent: false,
												child: false
											};
	
											emitters.parent.listeners.add("aType", function(e) {
												verify(this).is(parent);
												verify(e).source.is(child);
												called.parent = true;
											});
	
											emitters.child.listeners.add("aType", function(e) {
												verify(this).is(child);
												verify(e).source.is(child);
												called.child = true;
											});
	
											emitters.child.fire("aType");
											verify(called).parent.is(true);
											verify(called).child.is(true);
										</script>
									</li>
									<li class="function">
										<div class="name">remove</div>
										<span>Removes an event listener.</span>
										<div class="arguments">
											<div class="label">Arguments</div>
											<ol>
												<li class="value">
													<span class="type">string</span>
													<span>An event <dfn>type</dfn>.</span>
												</li>
												<li class="value">
													<span class="type">function</span>
													<span>A listener function.</span>
												</li>
											</ol>
										</div>
									</li>
									<script type="application/x.jsapi#tests">
										var source = new function() {
											var events = api.Events({ source: this });
				
											this.doIt = function(p) {
												events.fire("done", p);
											};
										};
				
										var received = [];
										var counter = function(e) {
											received.push(e);
										};
				
										verify(received).length.is(0);
										source.doIt();
										verify(received).length.is(0);
										source.listeners.add("other", counter);
										verify(received).length.is(0);
										source.doIt();
										verify(received).length.is(0);
										source.listeners.add("done", counter);
										source.doIt();
										verify(received).length.is(1);
										verify(received)[0].source.is(source);
										source.listeners.remove("done", counter);
										source.doIt();
										verify(received).length.is(1);
									</script>
								</ul>
							</li>
							<li class="function">
								<div class="name">fire</div>
								<span>Causes this object to fire an event to its listeners.</span>
								<div class="arguments">
									<div class="label">Arguments</div>
									<ol>
										<li class="value">
											<span class="type">string</span>
											<span>An event type.</span>
										</li>
										<li class="value">
											<span class="type">(any)</span>
											<span>
												An event <dfn>detail</dfn>, which can be any type, and will be used as the
												<code>detail</code> property of the created event.
											</span>
										</li>
									</ol>
								</div>
							</li>
						</ul>
					</div>

					<div class="arguments">
						<div class="label">Arguments</div>
						<ol>
							<li class="object">
								<span>(optional)</span>
								<div class="label">has properties:</div>
								<ul>
									<li class="value">
										<div class="name">source</div>
										<span class="type">__TYPE__</span>
										<span>
											(optional; default is the created <a href="#types.emitter">emitter</a>)
										</span>
										<script type="application/x.jsapi#tests">
											var source = {};

											var noSource = $api.Events();
											var withSource = $api.Events({ source: source });

											var Captor = function() {
												var captured = [];
												var captor = function(e) {
													captured.push(e);
												}
												return {
													captured: captured,
													captor: captor
												};
											};

											var captorOne = new Captor();
											var captorTwo = new Captor();

											noSource.listeners.add("foo", captorOne.captor);
											withSource.listeners.add("foo", captorTwo.captor);

											noSource.fire("foo");
											withSource.fire("foo");

											verify(captorOne).captured.length.is(1);
											verify(captorOne).captured[0].source.is(noSource);
											verify(captorTwo).captured.length.is(1);
											verify(captorTwo).captured[0].source.is(source);
										</script>
									</li>
									<li class="value">
										<div class="name">parent</div>
										<span class="type">__TYPE__</span>
										<span>__DESCRIPTION__</span>
										<script type="application/x.jsapi#tests">
											var parent = api.Events();
											var child = api.Events({ parent: parent });

											var received = {
												parent: [],
												child: []
											};

											var receive = function(name) {
												return function(e) {
													received[name].push({ source: e.source, path: e.path.slice() });
												};
											};

											parent.listeners.add("aType", receive("parent"));
											child.listeners.add("aType", receive("child"));

											parent.fire("aType");
											verify(received).parent.length.is(1);
											verify(received).child.length.is(0);
					
											child.fire("aType");
											verify(received).parent.length.is(2);
											verify(received).child.length.is(1);
										</script>
									</li>
								</ul>
							</li>
						</ol>
					</div>

					<div class="returns">
						<div class="label">Returns</div>
						<span class="type"><a href="#types.emitter">emitter</a></span>
						<span>An emitter configured using the argument.</span>
						<script type="application/x.jsapi#tests">
							var emitter = api.Events();
							verify(emitter).listeners.is.type("object");
							verify(emitter).listeners.evaluate.property("add").is.type("function");
							verify(emitter).listeners.evaluate.property("remove").is.type("function");
							verify(emitter).evaluate.property("fire").is.type("function");
						</script>
					</div>
					<div class="label">has properties:</div>
					<ul>
						<li class="function experimental">
							<div class="name">instance</div>
							<span>Determines whether a given argument is an event emitter.</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
									<li class="value">
										<span class="type">(any)</span>
										<span>A JavaScript value.</span>
									</li>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">boolean</span>
								<span><code>true</code> if the argument is an <a href="#types.emitter">emitter</a>.</span>
							</div>
							<script type="application/x.jsapi#tests">
								var x = api.Events();
								verify(api.Events.instance(api.Events())).is(true);
								verify(api.Events.instance({})).is(false);
							</script>
						</li>
						<li class="function">
							<div class="name">Function</div>
							<span>__DESCRIPTION__</span>
							<div class="arguments">
								<div class="label">Arguments</div>
								<ol>
								</ol>
							</div>
							<div class="returns">
								<div class="label">Returns</div>
								<span class="type">__TYPE__</span>
								<span>__DESCRIPTION__</span>
							</div>
							<script type="application/x.jsapi#tests">
								var firesArgumentPropertyValues = function(p,events) {
									for (var x in p) {
										events.fire(x, p[x]);
									}
								};

								var Captor = function() {
									var events = [];

									var received = function(e) {
										events.push(e);
									};

									this.a = received;
									this.b = received;

									this.got = events;
								};

								var onPropertyValues = api.Events.Function(firesArgumentPropertyValues);
								var on = new Captor();
								onPropertyValues({}, on);
								verify(on,"on").got.length.is(0);

								var onA = new Captor();
								onPropertyValues({ a: {} }, onA);
								verify(onA,"on").got.length.is(1);
								verify(onA,"on").got[0].type.is("a");

								var source = {};
								var events = api.Events({
									source: source
								});
								var payload = {};
								var received; 
								events.listeners.add("a", function(e) {
									received = e;
								})
								onPropertyValues({ a: payload }, events);
								verify(received).is.type("object");
								verify(received).detail.is(payload);
							</script>
						</li>
					</ul>
				</li>
				<li class="object experimental">
					<div class="name">threads</div>
					<span>__DESCRIPTION__</span>
					<div class="label">has properties:</div>
					<ul>
						<li class="object">
							<div class="name">steps</div>
							<span>__DESCRIPTION__</span>
							<div class="type">
								<a class="type" name="types.threads.step">step</a>
								<span>__DESCRIPTION__</span>
								<div class="label">has properties:</div>
								<ul>
								</ul>
							</div>
							<div class="label">has properties:</div>
							<ul>
								<li class="function">
									<div class="name">run</div>
									<span>__DESCRIPTION__</span>
									<div class="arguments">
										<div class="label">Arguments</div>
										<ol>
											<li class="value">
												<div class="name">steps</div>
												<span class="type">Array of <a href="#types.threads.step">step</a></span>
												<span>__DESCRIPTION__</span>
											</li>
											<li class="object">
												<span>An event handler</span>
												<div class="label">has properties:</div>
												<ul>
													<li class="value">
														<div class="name">unready</div>
														<span class="type">listener</span>
														<span>__DESCRIPTION__</span>
													</li>
												</ul>
											</li>
										</ol>
									</div>
									<div class="returns">
										<div class="label">Returns</div>
										<div class="label">has properties:</div>
										<ul>
											<li class="value">
												<div class="name">unready</div>
												<span class="type">Array of <a href="#types.threads.step">step</a></span>
												<span>A set of steps that never executed because they were never <code>ready()</code>.</span>
											</li>
										</ul>
									</div>
									<script type="application/x.jsapi#tests">
										verify(api,"$api").loadedByJsapi.is(true);
										verify(api,"$api").threads.steps.is.not.equalTo(null);
										verify(api,"$api").threads.steps.evaluate.property("run").is.not.equalTo(null);
				
										var $steps = verify(api,"$api").threads.steps;
										var $run = $steps.evaluate(function() { return this.run({ steps: [] }) });
										$run.threw.nothing();
				
										var A = function(shared) {
											this.ready = function() {
												return true;
											}
				
											this.run = function() {
												shared.a = true;
											}
										};
				
										var B = function(shared) {
											this.ready = function() {
												return shared.a;
											};
				
											this.run = function() {
												shared.b = true;
											}
										}
				
										var Shared = function() {
											this.a = false;
											this.b = false;
										};
				
										var Listener = function() {
											var unready = [];
				
											this.on = {
												unready: function(e) {
													unready.push(e.detail);
												}
											}
				
											this.unready = unready;
										}
				
										var s1 = new Shared();
										$steps.run({
											steps: [ new A(s1) ]
										});
										verify(s1).a.is(true);
				
										var s2 = new Shared();
										$steps.run({
											steps: [ new B(s2), new A(s2) ]
										});
										verify(s2).a.is(true);
										verify(s2).b.is(true);
				
										var s3 = new Shared();
										var b3 = new B(s3);
										var l3 = new Listener();
										verify(api).threads.steps.run({
											steps: [ b3 ]
										}, l3.on).unready.length.is(1);
										verify(s3).a.is(false);
										verify(s3).b.is(false);
										verify(l3).unready.length.is(1);
										verify(l3).unready[0].is(b3);
									</script>
								</li>
							</ul>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</body>
</html>